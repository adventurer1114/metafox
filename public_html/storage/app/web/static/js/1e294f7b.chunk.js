(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chat-components-ChatRoomPanel-Block"],{30998:function(e,t,a){var n=a(41848),i=a(67206),r=a(40554),l=Math.max;e.exports=function(e,t,a){var o=null==e?0:e.length;if(!o)return -1;var s=null==a?0:r(a);return s<0&&(s=l(o+s,0)),n(e,i(t,3),s)}},87229:function(e,t,a){"use strict";a.d(t,{Z:function(){return b}});var n=a(76224),i=a(81719),r=a(67294),l=a(30120);let o="PreviewUploadFile",s=(0,i.ZP)("img",{name:o,slot:"previewImage"})(({theme:e})=>({borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",marginRight:e.spacing(2),objectFit:"cover"})),c=(0,i.ZP)("div",{name:o,slot:"PreviewFile",shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({borderRadius:e.spacing(1),maxWidth:"150px",width:"150px",height:"52px",marginRight:e.spacing(2),fontSize:e.spacing(1.5),display:"flex",alignItems:"center",background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],...t&&{maxWidth:"180px",width:"180px",overflowX:"hidden"}})),d=(0,i.ZP)("div",{name:o,slot:"IconFile"})(({theme:e})=>({borderRadius:"100%",maxWidth:"28px",width:"28px",height:"28px",margin:e.spacing(0,1),padding:e.spacing(0,1),color:e.palette.default.contrastText,background:"light"===e.palette.mode?e.palette.grey["500"]:e.palette.grey["700"],display:"inline-flex",justifyContent:"center",alignItems:"center"})),p=(0,i.ZP)("div",{name:o,slot:"closeButton"})(({theme:e})=>({position:"absolute",top:"-8px",right:"8px",cursor:"pointer",width:e.spacing(2.5),height:e.spacing(2.5),backgroundColor:e.palette.grey["500"],borderRadius:"50%",fontSize:e.mixins.pxToRem(8),justifyContent:"center",alignItems:"center",display:"inline-flex",opacity:.8,color:(e.palette.mode,e.palette.text.primary),"&:hover":{backgroundColor:e.palette.background.default,color:e.palette.text.primary,border:e.mixins.border("secondary")}})),m=(0,i.ZP)(n.Ys)(({theme:e})=>({paddingRight:e.spacing(1),wordBreak:"break-word",p:{fontSize:e.mixins.pxToRem(13)}}));var u=function({onRemove:e,file:t,isAllPage:a}){let i=t.type,o=["image/gif","image/jpeg","image/png"].includes(i),u=o?URL.createObjectURL(t):"";return r.createElement(l.Z,{display:"inline-flex",position:"relative"},o?r.createElement(s,{src:u,alt:"Preview"}):r.createElement(c,{isAllPage:a},r.createElement(d,null,r.createElement(n.zb,{icon:"ico-paperclip-alt"})),r.createElement(m,{lines:2},t.name)),r.createElement(l.Z,{position:"absolute",top:1,right:1},r.createElement(p,{"data-testid":"buttonRemove",onClick:e,"aria-label":"Close"},r.createElement(n.zb,{icon:"ico-close"}))))};let g=(0,i.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({background:e.palette.background.paper,padding:e.spacing(2,1,0,1),display:"flex",overflow:"hidden",borderTop:e.mixins.border("secondary"),userSelect:"none",height:"85px",minHeight:"85px",...t&&{height:"90px",minHeight:"90px"}})),h=(0,i.ZP)("div")(({theme:e})=>({display:"flex",overflowX:"auto",paddingTop:e.spacing(1),marginBottom:e.spacing(.5),paddingBottom:e.spacing(.5),"&::-webkit-scrollbar":{height:"5px",width:"5px",background:"transparent",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{margin:e.spacing(.5,0),borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:e.palette.grey["700"],borderRadius:"10px"}})),f=(0,i.ZP)("div",{slot:"ButtonAdd"})(({theme:e})=>({marginRight:e.spacing(1),cursor:"pointer",span:{background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],"&:hover":{background:e.palette.action.hover},borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:e.spacing(2.5)}}));var b=r.forwardRef(function({filesUploadRef:e,isAllPage:t},a){let[i,l]=r.useState([]),[o,s]=r.useState("image"),c=r.useRef(),d=r.useRef(),p=t=>{let a=[...i];if(t>-1&&(a.splice(t,1),l([...a]),e)){var n;null===(n=e.current)||void 0===n||n.removeFile(t)}};if(r.useImperativeHandle(a,()=>{return{attachFiles:e=>{(null==e?void 0:e.length)&&l(e)},typeUpload:e=>{e&&s(e)},clear:()=>{l([])},checkIsLoading:()=>{}}}),!i||!(null==i?void 0:i.length))return null;let m=()=>{c.current.click()},b=()=>{d.current.click()},v=()=>{if("image"===o){m();return}b()},x=()=>{if(!c.current.files.length)return;let t=[...i,...c.current.files];if(l(t),e){var a;null===(a=e.current)||void 0===a||a.attachFiles(t)}},y=()=>{if(!d.current.files.length)return;let t=[...i,...d.current.files];if(l(t),e){var a;null===(a=e.current)||void 0===a||a.attachFiles(t)}};return r.createElement(g,{isAllPage:t},r.createElement(h,null,Object.values(i).map((e,a)=>r.createElement(u,{key:a,file:e,onRemove:()=>p(a),isAllPage:t})),r.createElement(f,{onClick:v},r.createElement("span",null,r.createElement(n.zb,{icon:"ico-text-file-plus"})))),r.createElement("input",{"data-testid":"inputAttachPhoto",onChange:x,multiple:!0,ref:c,style:{display:"none"},type:"file",accept:"image/*"}),r.createElement("input",{style:{display:"none"},type:"file",multiple:!0,ref:d,onChange:y}))})},46781:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return es}});var n=a(85597),i=a(37344),r=a(21241),l=a(76224),o=a(81719),s=a(62097),c=a(30120),d=a(35705),p=a(67294),m=a(10159),u=a(13478),g=a(21822),h=a(81674),f=a(23279),b=a.n(f);let v=(0,o.ZP)("div")(()=>({width:"100%"})),x=(0,o.ZP)(h.ZP,{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({maxWidth:"600px",height:e.spacing(5),margin:e.spacing(2),padding:e.spacing(1.5,2),borderRadius:e.spacing(2.5),border:e.mixins.border("secondary"),backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.grey["100"],...t&&{margin:0,width:"100%",padding:e.spacing(0,1),"& input":{padding:e.spacing(.25,1,0,1)}}})),y=(0,o.ZP)(l.zb,{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({color:e.palette.text.primary,transition:"all .2s ease",cursor:"pointer",...t&&{padding:e.spacing(1)}}));(0,o.ZP)("div",{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:e.palette.grey["600"],marginRight:e.spacing(1.5),...t&&{marginRight:e.spacing(.75)}})),(0,o.ZP)("span")(({theme:e})=>({marginRight:e.spacing(0,.25),color:e.palette.text.primary}));var E=function({toggleSearch:e,room:t,searching:a}){let{i18n:i,dispatch:r,useIsMobile:l}=(0,n.OgA)(),o=l(),s=p.useRef();p.useEffect(()=>{s.current="",m()},[a]);let c=e=>{s.current=e.target.value,m()},d=p.useCallback(()=>{r({type:"chat/room/searchMessages",payload:{roomId:null==t?void 0:t.id,text:s.current},meta:{}})},[r,t]),m=p.useMemo(()=>{return b()(d,200)},[d]);return o?p.createElement(v,null,p.createElement(x,{isMobile:o,startAdornment:p.createElement(y,{icon:"ico-search-o",isMobile:o}),endAdornment:p.createElement(y,{icon:"ico-close",onClick:e}),placeholder:i.formatMessage({id:"search_this_conversation"}),autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off"},inputRef:s,onChange:c})):p.createElement(v,null,p.createElement(x,{startAdornment:p.createElement(y,{icon:"ico-search-o"}),endAdornment:p.createElement(y,{icon:"ico-close",onClick:e}),placeholder:i.formatMessage({id:"search_this_conversation"}),autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off"},inputRef:s,onChange:c}))};let w=(0,o.ZP)("div",{shouldForwardProp:e=>"isMobile"!==e&&"openSearch"!==e})(({theme:e,isMobile:t,openSearch:a})=>({backgroundColor:e.palette.background.paper,alignItems:"center",boxSizing:"border-box",display:"flex",height:e.spacing(9),padding:e.spacing(1,1,1,2),justifyContent:"space-between",borderBottom:e.mixins.border("secondary"),...t&&!a&&{padding:e.spacing(1,.5,1,1)}})),P=(0,o.ZP)("div")(({theme:e})=>({})),k=(0,o.ZP)("div")(({theme:e})=>({padding:e.spacing(1.75,0),display:"flex",alignItems:"center",cursor:"pointer"})),C=(0,o.ZP)("span")(({theme:e})=>({...e.typography.h4,margin:e.spacing(0,1.5,0,2)})),Z=(0,o.ZP)(g.Z,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,fontSize:e.spacing(2.25),minWidth:e.spacing(6.25),...t&&{color:e.palette.primary.main},padding:0,margin:0})),R=(0,o.ZP)("div")(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center"})),A=(0,o.ZP)("div")(({theme:e})=>({flex:1,display:"flex",alignItems:"center",justifyContent:"space-between"})),M=(0,o.ZP)(g.Z,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,fontSize:e.spacing(2.25),minWidth:e.spacing(4),...t&&{color:e.palette.primary.main}}));var S=function({room:e,searching:t}){let{dispatch:a,useActionControl:r,useIsMobile:o,navigate:s,useGetItem:c}=(0,n.OgA)(),d=o(),[g,h]=p.useState(!1),f=(null==e?void 0:e.other_members[0])||void 0,b=c(f),[v]=r(null==e?void 0:e.id,{}),x=(t,n,i)=>{v(t,n,i),"chat/room/toggleSearching"===t&&(a({type:"chat/room/searchMessages",payload:{roomId:null==e?void 0:e.id,text:""}}),h(e=>!e))},y=(0,m.Mn)(),S=p.useMemo(()=>(0,u.W$)(y,{isMobile:d}),[y,d]);p.useEffect(()=>{h(!1)},[e]);let I=p.useCallback(()=>{a({type:"chat/room/toggleSearching",payload:{identity:null==e?void 0:e.id}}),a({type:"chat/room/searchMessages",payload:{roomId:null==e?void 0:e.id,text:""}}),h(e=>!e)},[a,e]),F=()=>{s({pathname:"/messages"})};return d?p.createElement(w,{isMobile:d,openSearch:g},g?null:p.createElement(Z,{onClick:F},p.createElement(l.zb,{icon:"ico-arrow-left"})),g?p.createElement(E,{toggleSearch:I,room:e,searching:t}):p.createElement(A,null,p.createElement(k,null,p.createElement(l.Yt,{user:b,size:48}),p.createElement(C,null,null==e?void 0:e.name)),p.createElement(P,null,p.createElement(R,null,p.createElement(i.BB,{items:S,handleAction:x,displayLimit:2}))))):p.createElement(w,null,p.createElement(k,null,e?p.createElement(l.Yt,{user:b,size:48}):null,p.createElement(C,null,null==e?void 0:e.name)),p.createElement(P,null,g?p.createElement(E,{toggleSearch:I,room:e,searching:t}):p.createElement(R,null,p.createElement(M,{onClick:I},p.createElement(l.zb,{icon:"ico-search-o"})),p.createElement(i.BB,{items:S,handleAction:v,variant:"pageMessage"}))))},I=a(1469),F=a.n(I);let _="ChatRoomPanel",z=(0,o.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"column",borderLeft:e.mixins.border("secondary"),backgroundColor:e.palette.background.paper,width:"100%",height:"100%"})),O=(0,o.ZP)("div",{name:_,slot:"mainContent"})(({theme:e})=>({display:"flex",flexDirection:"row",alignItems:"center",borderBottom:e.mixins.border("secondary")})),j=(0,o.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"row",backgroundColor:e.palette.background.paper,flex:1})),T=(0,o.ZP)("div")(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",width:"100%",minWidth:0})),B=(0,o.ZP)("div",{name:_,slot:"Title"})(({theme:e})=>({fontSize:e.spacing(1.875),padding:e.spacing(3.5,2),fontWeight:e.typography.fontWeightMedium,alignSelf:"flex-start",color:e.palette.text.secondary,minWidth:"130px"})),D=(0,o.ZP)("div",{name:_,slot:"SearchWrapper"})(({theme:e})=>({flex:1,minWidth:0,margin:e.spacing(1),position:"relative",zIndex:e.zIndex.speedDial})),W=(0,o.ZP)("div",{name:_,slot:"WrapperSuggest",shouldForwardProp:e=>"suggestList"!==e})(({theme:e,suggestList:t})=>({...!0===t&&{position:"absolute",width:"100%",border:e.mixins.border("secondary"),borderTop:"none",backgroundColor:e.palette.background.paper,borderEndEndRadius:e.spacing(1),borderEndStartRadius:e.spacing(1)}})),H=(0,o.ZP)("div")(({theme:e})=>({padding:e.spacing(1.75,2),display:"flex",alignItems:"center",cursor:"pointer",borderBottom:e.mixins.border("secondary"),"&:last-child":{borderBottom:"none"}})),L=(0,o.ZP)("span")(({theme:e})=>({...e.typography.h5,marginLeft:e.spacing(1)}));var N=function(){let{i18n:e,dispatch:t,apiClient:a}=(0,n.OgA)(),o=p.useRef(""),[s,c]=p.useState(""),[d,m]=p.useState(!1),[u,g]=p.useState([]),h=p.useMemo(()=>{let e=()=>{a.get("/friend",{params:{limit:10,q:o.current||void 0}}).then(e=>e.data.data).then(e=>F()(e)&&g(e)).catch(e=>{})};return b()(e,200)},[a,o.current]);p.useEffect(()=>{h()},[]);let f=p.useCallback(e=>{t({type:"chat/newChatRoom",payload:{user:e,isPage:!0}})},[]),v=p.useCallback(e=>{},[]),x=p.useCallback(e=>{var t;let a=null===(t=e.currentTarget)||void 0===t?void 0:t.value;o.current=a,c(a),h(),m(!0)},[]),y=()=>{m(!1)};return p.createElement(z,null,p.createElement(O,null,p.createElement(B,null,e.formatMessage({id:"new_message"})),p.createElement(l.Qn,{onClickAway:y},p.createElement(D,null,p.createElement(i.zj,{sx:{p:0},valueSearch:s,onChangeSearch:x,onKeyUp:v,placeholder:e.formatMessage({id:"type_name_start_new_conversation"}),size:30,isShowButtonSubmit:!1}),d?p.createElement(W,{suggestList:Boolean(u&&u.length)},p.createElement("div",null,p.createElement(r.l$,{autoHide:!0,autoHeight:!0},u.map((e,t)=>p.createElement(p.Fragment,{key:t},p.createElement(H,{onClick:()=>f(e)},p.createElement(l.Yt,{user:e,size:32,noLink:!0}),p.createElement(L,null,e.full_name))))))):null))),p.createElement(j,null,p.createElement(T,null)))},$=a(41609),U=a.n($),Y=a(38779),G=a(48309),q=a(40263),K=a(87229);let X="ChatRoomPanel",Q=(0,o.ZP)("div",{name:X,slot:"root",shouldForwardProp:e=>"loading"!==e})(({theme:e,loading:t})=>({borderLeft:e.mixins.border("secondary"),backgroundColor:e.palette.background.paper,display:"flex",flexDirection:"row",width:"100%",height:"100%","& .MuiAvatar-root":{fontSize:e.mixins.pxToRem(14)}})),J=(0,o.ZP)("div",{name:X,slot:"mainContent"})(({theme:e})=>({flex:1,display:"flex",width:"100%",height:"100%"})),V=(0,o.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"row",width:"100%",flex:1,minHeight:0})),ee=(0,o.ZP)("div",{name:X,slot:"Main",shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"})),et=(0,o.ZP)("div")(({theme:e})=>({textAlign:"center",padding:e.spacing(2),fontStyle:"italic",color:"dark"===e.palette.mode?e.palette.text.primary:e.palette.grey["700"],fontSize:e.spacing(1.75)})),ea=(0,o.ZP)("div",{name:X,slot:"ReplyEditWrapper"})(({theme:e})=>({padding:e.spacing(.625,1.25),height:"50px",width:"100%",borderTop:e.mixins.border("secondary"),display:"flex",justifyContent:"space-between",backgroundColor:"dark"===e.palette.mode?e.palette.grey["600"]:e.palette.grey["100"]})),en=(0,o.ZP)(l.Ys,{name:X,slot:"SelectedMsg"})(({theme:e})=>({color:e.palette.text.primary})),ei=(0,o.ZP)(l.zb,{name:X,slot:"LineIconClose"})(({theme:e})=>({cursor:"pointer",alignSelf:"center"})),er=(0,o.ZP)("div",{name:X,slot:"SelectedMsgAttachment"})(({theme:e})=>({fontSize:e.spacing(1.5),margin:e.spacing(.5,0),"& .ico":{marginRight:e.spacing(.5)}})),el=(0,o.ZP)("div",{name:X,slot:"ContentWrapper"})(({theme:e})=>({overflow:"hidden"})),eo=(0,o.ZP)("div",{name:X,slot:"LoadingStyled"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",marginTop:e.spacing(3)}));var es=(0,n.j4Z)({name:"ChatRoomPanel",extendBlock:function(e){var t;let{i18n:a,jsxBackend:o,usePageParams:u,useActionControl:g,dispatch:h,useIsMobile:f}=(0,n.OgA)(),b=u(),{rid:v}=b,x=f(),y=p.useRef(),E=p.useRef(),w=p.useRef(),P=p.useRef(),k=(0,m.pB)(v),[C]=g(v,{}),[Z,R]=(0,p.useState)("no_react"),[A,M]=(0,p.useState)(),[I,F]=(0,p.useState)(void 0),[_,z]=(0,p.useState)(!1),O=(0,s.Z)(),j=null==k?void 0:k.searching,T=o.get("ChatSimpleComposer"),B=()=>{R("no_react"),M(void 0)},D=p.useCallback(()=>{v&&h({type:"chat/room/markAsRead",payload:{identity:v}})},[v,h]);p.useEffect(()=>{return v&&(z(!0),h({type:"chat/room/markAsRead",payload:{identity:v}}),h({type:"chat/room/active",payload:v,meta:{onSuccess:e=>{F(e),z(!1)},onFailure:()=>{z(!1)}}})),()=>{h({type:"chat/room/inactive",payload:{rid:v}}),h({type:"chat/room/closeSearching",payload:{identity:v}}),B(),F(void 0)}},[v]);let W=null==k?void 0:k.messageFilter,H={backgroundColor:O.palette.background.paper},L=p.useMemo(()=>{return(null==A?void 0:A.message)?(0,q.Hj)(null==A?void 0:A.message):""},[A]);if(!v&&!x&&!I)return p.createElement(N,null);let $=(e,t)=>{if(!e)return;let a=e.split(/.,| /);a.forEach(e=>{switch(e){case"chat/replyMessage":R("reply"),M(t);break;case"chat/editMessage":R("edit"),M(t)}})},X=()=>{B(),(null==P?void 0:P.current)&&P.current.scrollToBottom()};return p.createElement(Q,{loading:_||!I&&v},p.createElement(J,null,p.createElement(V,null,p.createElement(ee,{isMobile:x},p.createElement(S,{room:I,searching:j}),p.createElement(c.Z,{sx:{flex:1,minHeight:0}},p.createElement(r.l$,{autoHeight:!0,autoHeightMax:"100%",ref:y,style:H},j||_?null:p.createElement(et,null,a.formatMessage({id:"start_of_conversation"})),_&&p.createElement(eo,{"data-testid":"loadingIndicator"},p.createElement(d.Z,{size:24})),j&&W?p.createElement(c.Z,{sx:{mt:2}},p.createElement(G.Z,{items:W,room:I,disableReact:!0,handleAction:C})):p.createElement(Y.Z,{rid:v,groups:null==k?void 0:k.groups,groupIds:null==k?void 0:k.groupIds,newest:null==k?void 0:k.newest,room:I,containerRef:y,disableReact:!1,handleAction:$,ref:P,loading:_,roomProgress:null==k?void 0:k.roomProgress,isAllPage:!0}))),"no_react"!==Z&&p.createElement(ea,null,p.createElement(el,null,p.createElement("div",null,"reply"===Z?a.formatMessage({id:"reply_to_user_at_timestamp"},{user:null==A?void 0:null===(t=A.user)||void 0===t?void 0:t.full_name,time:new Date(A.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}):a.formatMessage({id:"editing"})),U()(null==A?void 0:A.attachments)?p.createElement(en,{lines:1,dangerouslySetInnerHTML:{__html:L}}):p.createElement(er,null,p.createElement(l.zb,{icon:"ico-paperclip-alt"}),p.createElement("span",null,a.formatMessage({id:"file_attachment"})))),p.createElement(ei,{icon:"ico-close",onClick:()=>R("no_react")})),p.createElement(K.Z,{ref:E,filesUploadRef:w,isAllPage:!0}),p.createElement(i.jH,{searching:j},p.createElement(T,{rid:v,msgId:null==A?void 0:A.id,reactMode:Z,text:"edit"===Z?L:"",onSuccess:X,previewRef:E,ref:w,isAllPage:!0,onMarkAsRead:D}))))))}})},37344:function(e,t,a){"use strict";a.d(t,{zj:function(){return u},s_:function(){return A},KG:function(){return h},jH:function(){return E},V9:function(){return P},pY:function(){return U},BB:function(){return X},ay:function(){return L}});var n,i,r=a(76224),l=a(30120),o=a(21822),s=a(81719),c=a(67294);let d=(0,s.ZP)("div",{name:"ChatDockFilter"})(({theme:e})=>({position:"relative"})),p=(0,s.ZP)(l.Z,{name:"ChatDockFilter"})(({theme:e})=>({padding:e.spacing(1,1,1,2),display:"flex",flexDirection:"row",alignItems:"center"})),m=(0,s.ZP)(o.Z,{name:"ChatDockFilter"})(({theme:e})=>({marginLeft:e.spacing(.5)}));function u({placeholder:e,size:t,hide:a,label:n,disabled:i,valueSearch:l,onChangeSearch:o,onKeyUp:s,onSubmit:u,variant:g="direct",isShowButtonSubmit:h=!0,sx:f}){return a?null:c.createElement(d,null,c.createElement(p,{sx:f},c.createElement(r.Rj,{placeholder:e,onKeyUp:s,value:l,onChange:o}),h&&u?c.createElement(m,{disabled:i,size:"medium",color:"primary",variant:"text",onClick:u},n):null))}let g=(0,s.ZP)("div",{name:"ChatDockContent",slot:"root",shouldForwardProp:e=>"searching"!==e&&"collapsed"!==e})(({theme:e,searching:t,collapsed:a})=>({flex:1,maxHeight:"100%",position:"relative",paddingBottom:e.spacing(.75),...t&&{borderTop:"none"},...a&&{display:"none"},"&::-webkit-scrollbar":{height:"5px",width:"5px",background:"gray",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}}));var h=c.forwardRef(function({children:e,searching:t,collapsed:a},n){return c.createElement(g,{ref:n,searching:t,collapsed:a},e)}),f=a(85597);let b="ChatDockFooter",v=(0,s.ZP)("div",{name:b,slot:"root",shouldForwardProp:e=>"isAllPageMessages"!==e})(({theme:e,isAllPageMessages:t})=>({position:"relative",display:"flex",minHeight:e.spacing(5),zIndex:2,backgroundColor:e.palette.background.paper,borderTop:e.mixins.border("secondary"),...t&&{minHeight:e.spacing(6)}})),x=(0,s.ZP)("div",{name:b,slot:"uiChatRoomFooter",shouldForwardProp:e=>"disable"!==e&&"isAllPageMessages"!==e})(({theme:e,disable:t,isAllPageMessages:a})=>({position:"relative",borderTop:e.mixins.border("secondary"),display:"flex",alignItems:"flex-end",minHeight:e.spacing(5),zIndex:2,flexFlow:"wrap",justifyContent:"center",...t&&{userSelect:"none",backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.background.paper},...a&&{minHeight:e.spacing(6)}})),y=(0,s.ZP)("div",{name:b,slot:"uiChatComposerContainer"})(({theme:e})=>({textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",padding:"4px 8px",color:e.palette.grey["500"]}));function E({children:e,archived:t,isReadOnly:a,isMuted:n,searching:i}){let{i18n:r,usePageParams:l}=(0,f.OgA)(),o=l(),s=(null==o?void 0:o.isAllPageMessages)||!1;return i?null:t?c.createElement(x,{disable:!0,isAllPageMessages:s},c.createElement(y,null,r.formatMessage({id:"this_group_is_archived"}))):a?c.createElement(x,{disable:!0,isAllPageMessages:s},c.createElement(y,null,r.formatMessage({id:"this_group_is_readonly"}))):n?c.createElement(x,{disable:!0,isAllPageMessages:s},c.createElement(y,null,r.formatMessage({id:"you_have_been_muted_in_this_group"}))):c.createElement(v,{isAllPageMessages:s},e)}let w=(0,s.ZP)("div",{shouldForwardProp:e=>"searching"!==e&&"addNewMembers"!==e})(({theme:e,searching:t,addNewMembers:a})=>({display:"flex",alignItems:"center",minHeight:e.spacing(7),padding:e.spacing(1.5,1.25,1.5,2),borderBottom:e.mixins.border("secondary"),...(t||a)&&{borderBottom:"none"}}));function P({children:e,onClick:t,searching:a,addNewMembers:n}){let i=c.useCallback(e=>{e.preventDefault(),t&&t()},[t]);return c.createElement(w,{onClick:i,searching:a,addNewMembers:n},e)}let k="ChatDockPanel",C=(0,s.ZP)("div",{name:k,slot:"Root"})(({theme:e})=>({display:"flex",alignItems:"flex-end",marginLeft:e.spacing(2),width:"328px",zIndex:999})),Z=(0,s.ZP)("div",{name:k,slot:"PanelStyled"})(({theme:e})=>({display:"flex",flexDirection:"column",zIndex:10,backgroundColor:e.mixins.backgroundColor("paper"),borderTopLeftRadius:"4px",borderTopRightRadius:"4px",boxShadow:"0 0 4px 0 rgba(0,0,0,0.2)",wordBreak:"break-word",wordWrap:"break-word",borderStartStartRadius:e.spacing(1),borderStartEndRadius:e.spacing(1),height:"455px",maxHeight:"calc(100vh - 60px)"})),R=(0,s.ZP)("div",{name:k,slot:"StageStyled"})(({theme:e})=>({width:"100%"}));var A=c.forwardRef(function({children:e},t){return c.createElement(C,{ref:t},c.createElement(R,null,c.createElement(Z,null,e)))}),M=a(81674),S=a(86010),I=a(23279),F=a.n(I),_=a(22410),z=a(73327),O=(0,_.Z)(e=>(0,z.Z)({optionLabel:{width:"32px",height:"32px",display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:"#a2a2a2"},optionChecked:{color:e.palette.primary.main},optionInput:{display:"none"},optionIcon:{display:"inline-flex",alignItems:"center",marginTop:"1px",height:"14px",marginRight:"4px"}}),{name:"ChatDockSearchFilter"});let j=(0,s.ZP)("div")(({theme:e})=>({})),T=(0,s.ZP)("div")(({theme:e})=>({display:"inline-flex"})),B=(0,s.ZP)(M.ZP)(({theme:e})=>({display:"flex",width:"100%","&.Mui-focused":{borderColor:e.palette.primary.main}})),D=(0,s.ZP)(l.Z,{name:"SearchBox",slot:"Root"})(({theme:e})=>({margin:e.spacing(0,2,1,2),height:e.spacing(5),borderRadius:e.spacing(2.5),display:"flex",alignItems:"center",backgroundColor:e.palette.action.hover}));function W({id:e,checked:t,icon:a,classes:n,value:i,roomId:l,onClick:o}){let{dispatch:s}=(0,f.OgA)(),d=()=>{s({type:i,payload:{identity:l}}),"function"==typeof o&&o(t?void 0:e)};return c.createElement("label",{className:(0,S.default)(n.optionLabel,t&&n.optionChecked)},c.createElement("input",{className:n.optionInput,type:"checkbox"}),c.createElement(r.zb,{icon:a,className:n.optionIcon,onClick:d}))}let H=({placeholder:e,size:t,hide:a,options:n=[],roomId:i,searching:o=!1})=>{let s=O(),{dispatch:d}=(0,f.OgA)(),p=(0,c.useRef)(null),m=(0,c.useRef)(null);(0,c.useEffect)(()=>{p.current="",m.current=null,b()},[o]);let u=e=>{p.current=e.target.value,b()},g=e=>{m.current=e,b()},h=(0,c.useCallback)(()=>{d({type:"chat/room/searchMessages",payload:{roomId:i,text:p.current}})},[d,i]),b=(0,c.useMemo)(()=>{return F()(h,200)},[h]);return((0,c.useEffect)(()=>{var e;n.length&&(m.current=null===(e=n.find(e=>e.checked))||void 0===e?void 0:e.id)},[n]),a)?null:c.createElement(j,null,c.createElement(D,null,c.createElement(B,{variant:"search",onChange:u,placeholder:e,startAdornment:c.createElement(r.zb,{icon:"ico-search-o"}),"aria-controls":"search_complete",endAdornment:c.createElement(l.Z,null,n&&n.length?c.createElement(T,null,n.map(e=>{return c.createElement(W,{id:e.id,key:e.id.toString(),checked:null==e?void 0:e.checked,classes:s,icon:e.icon,value:e.value,roomId:i,onClick:g})})):null)})))};var L=(0,c.memo)(H);(n=i||(i={})).Direct="d",n.Private="p",n.Public="c",n.OnlyUser="u",a(71682);let N=(0,s.ZP)("div")(({theme:e})=>({flex:1,fontWeight:"bold",display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"})),$=(0,s.ZP)("span",{shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t,type:a})=>({...e.typography.subtitle1,fontSize:"15px",lineHeight:e.spacing(2.375),...a===i.Direct&&{":hover":{cursor:"pointer",textDecoration:"underline"}},..."new_message"===t&&{fontSize:e.typography.pxToRem(18),":hover":{cursor:"auto",textDecoration:"none"}}}));function U({room:e,children:t,status:a,user:n,variant:r,isSelfChat:l=!1,loading:o=!1}){let{navigate:s}=(0,f.OgA)(),d=()=>{let t=n&&(n.username||n.user_name);(null==e?void 0:e.t)===i.Direct&&t&&s(`/${t}`)};return(null==e?void 0:e.t)===i.Direct?c.createElement(N,null,c.createElement($,{onClick:d,type:null==e?void 0:e.t},t)):c.createElement(N,null,c.createElement($,{type:null==e?void 0:e.t,variant:r},t))}var Y=a(30998),G=a.n(Y),q=(0,_.Z)(e=>(0,z.Z)({root:{display:"flex",padding:"0",margin:"0",listStyle:"none"},item:{position:"relative",lineHeight:"34px",padding:"0",margin:"0",".panelHeader &":{height:"30px",width:"30px",marginLeft:e.spacing(.5)},".panelHeader &:hover button":{color:e.palette.text.secondary,backgroundColor:e.palette.action.selected,borderRadius:"50%"}},btn:{height:"34px",lineHeight:"20px",fontSize:"17px",padding:"0 6px",cursor:"pointer",color:e.palette.text.hint,position:"relative",minWidth:e.spacing(3),display:"inline-flex",textAlign:"center",alignItems:"center",justifyContent:"center",border:"none",outline:"none",backgroundColor:"transparent",".panelHeader &":{height:"30px",width:"30px"}},itemActive:{},btnActive:{color:e.palette.primary.main}}),{name:"ChatDockToolbar"});let K=(0,s.ZP)("div",{name:"ToolbarChat",slot:"root",shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t})=>({display:"flex",padding:"0",margin:"0",listStyle:"none","& .MuiActionMenu-menu":"roomPanel"===t&&{overflow:"auto",maxHeight:"200px","&::-webkit-scrollbar":{height:"5px",width:"5px",background:"transparent",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{margin:e.spacing(.5,0),borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}}}));function X({items:e,displayLimit:t=2,variant:a=null,handleAction:n}){var i,l,o;let s=q();if(!Array.isArray(e))return null;if("roomPanel"===a){let d=t-1,p=e.filter((e,t)=>{return t<d||e.behavior}),m=G()(p,{behavior:"more"});if(m>-1){if(null===(i=p[m].items)||void 0===i?void 0:i.length)p[m].as="dropdown";else{let u=e.filter((e,t)=>t>d-1&&!e.behavior);p[m]={...p[m],items:u,as:"dropdown"}}}return c.createElement(K,{variant:a},c.createElement(r.sd,{items:p,prefixName:"chatplusToolbar.item.",fallbackName:"button",classes:s,handleAction:n}))}if("pageMessage"===a){let g=e.filter((e,t)=>{return e.behavior}),h=G()(g,{behavior:"more"});if(h>-1){if(null===(l=g[h].items)||void 0===l?void 0:l.length)g[h].as="dropdown";else{let f=e.filter((e,t)=>!e.behavior);g[h]={...g[h],items:f,as:"dropdown"}}}return c.createElement(K,{variant:a},c.createElement(r.sd,{items:g,prefixName:"chatplusToolbar.item.",fallbackName:"button",classes:s,handleAction:n,variant:a}))}let b=e.filter((e,a)=>a<t-1||e.behavior),v=G()(b,{behavior:"more"});if(v>-1){if(null===(o=b[v].items)||void 0===o?void 0:o.length)b[v].as="dropdown";else{let x=e.filter((e,a)=>a>t-2&&!e.behavior);b[v]={...b[v],items:x,as:"dropdown"}}}return c.createElement(K,null,c.createElement(r.sd,{items:b,prefixName:"chatplusToolbar.item.",fallbackName:"button",classes:s,handleAction:n}))}},48309:function(e,t,a){"use strict";a.d(t,{Z:function(){return x}});var n=a(85597),i=a(81719),r=a(41609),l=a.n(r),o=a(67294),s=a(98251),c=a(2475),d=a(86010),p=a(27937);let m=(0,i.ZP)("div",{name:"MsgItemFilter",slot:"uiChatMsgItemBody"})(({theme:e})=>({display:"flex"}));function u({msgId:e,tooltipPosition:t="top",showToolbar:a=!0,room:i,disableReact:r,handleAction:l}){let{jsxBackend:s,useSession:u,useGetItem:g,useActionControl:h}=(0,n.OgA)(),f=`chat.chatRooms.${null==i?void 0:i.id}.messageFilter.${e}`,b=g(f),{user:v}=u(),[x]=h(f,{});if(!b)return;let{id:y,attachments:E,reactions:w,type:P,created_at:k,user:C}=b||{},Z=(null==v?void 0:v.id)===(null==C?void 0:C.id),R=(0,c.jF)(k),A=(0,c.qF)(E),M=(e,t,a)=>{x(e,t,a),l(e,b,a)};return o.createElement("div",{className:"uiChatMsgItem","data-id":y,"data-t":P},o.createElement(m,null,o.createElement("div",{className:(0,d.default)("uiChatMsgItemBodyOuter",{hasToolbar:a,"multi-image":A>1})},s.render({component:`chat.messageContent.${P}`,props:{message:b,isOwner:Z,user:C,createdDate:R,msgType:P,tooltipPosition:t}}))),o.createElement(p.Z,{identity:f,disabled:r,reactions:w,handleAction:M}))}let g="MessageFilter",h=(0,i.ZP)("div",{name:g,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isGroup"!==e})(({theme:e,isOwner:t,isAlert:a,isGroup:n})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...a&&{"&.uiChatMsgSetAvatar":{display:"none"},"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse"}})),f=(0,i.ZP)("div",{name:g,slot:"uiChatMsgSetAvatar"})(({theme:e})=>({marginRight:e.spacing(1)})),b=(0,i.ZP)("div",{name:g,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"]})),v=({disableReact:e,room:t,items:a,handleAction:i})=>{let{i18n:r}=(0,n.OgA)();return l()(a)?o.createElement(b,null,r.formatMessage({id:"no_items_found"})," "):o.createElement("div",null,a&&Object.values(a).map(a=>o.createElement(h,{key:a.id.toString()},o.createElement(f,null,o.createElement(s.Z,{user:a.user,size:32})),o.createElement(u,{msgId:a.id,disableReact:e,room:t,handleAction:i}))))};var x=v},98251:function(e,t,a){"use strict";var n=a(85597),i=a(76224),r=a(67294);t.Z=(0,r.memo)(function({identity:e,size:t=30,user:a}){let{useGetItem:l}=(0,n.OgA)(),o=l(e);return a||o?r.createElement(i.Yt,{user:a||o,size:t,noLink:!0}):null})},38779:function(e,t,a){"use strict";a.d(t,{Z:function(){return el}});var n=a(2475),i=a(85597),r=a(81719),l=a(67294);let o=l.createContext(l.createRef());var s=a(98251),c=a(10159),d=a(27937),p=a(13478),m=a(86010),u=a(76224),g=a(21822),h=a(38790);let f="MsgActionMenu",b=(0,r.ZP)("div",{name:f,slot:"root"})(({theme:e})=>({"& .MuiActionMenu-menu":{overflow:"auto",maxHeight:"220px"}})),v=(0,r.ZP)(g.Z,{name:f,slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.5),cursor:"pointer",minWidth:e.spacing(3),lineHeight:e.spacing(2.5)}));function x({identity:e,handleAction:t,scrollRef:a,items:n}){let{ItemActionMenu:r,i18n:o}=(0,i.OgA)();return l.createElement(b,null,l.createElement(r,{disablePortal:!0,items:n,placement:"auto-start",identity:e,handleAction:t,dependName:"chatplus/msgActionMenu",scrollRef:a,scrollClose:!0,control:l.createElement(h.Z,{title:o.formatMessage({id:"more"}),placement:"top",PopperProps:{disablePortal:!0}},l.createElement(v,{disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0,className:"uiChatItemBtn"},l.createElement(u.zb,{icon:"ico-dottedmore-vertical-o"})))}))}var y=a(25722),E=a(62937),w=a(40471),P=a(22410),k=a(73327),C=a(41609),Z=a.n(C);let R=(0,P.Z)(e=>(0,k.Z)({paper:{borderRadius:24,margin:0,padding:0},itemsRoot:{display:"flex",flexDirection:"row"},itemRoot:{padding:"4px",display:"flex",alignItem:"center",alignSelf:"center"},itemImage:{width:27,height:27},active:{background:e.palette.grey["300"],padding:e.spacing(.5),borderRadius:e.spacing(1),width:34,height:34,display:"flex",alignItem:"center",justifyContent:"center",margin:e.spacing(.2)}}),{name:"ReactionThisItemPopover"}),A=({item:e,classes:t,onClick:a,active:n})=>{return l.createElement("div",{className:(0,m.default)(t.itemRoot,n&&t.active),role:"button",onClick:a,"aria-label":e.title,"data-testid":"itemReaction"},l.createElement(h.Z,{title:e.title},l.createElement("img",{src:e.src,draggable:!1,alt:e.title,className:t.itemImage})))};var M=function({onEmojiClick:e,unsetReaction:t,identity:a}){let{useSession:n}=(0,i.OgA)(),r=(0,w.z)(),o=R(),s=(0,c.v2)(a),{user:d}=n(),p=e=>{var t,a;if(Z()(null==s?void 0:null===(t=s.reactions)||void 0===t?void 0:t[e]))return!1;let n=null==s?void 0:null===(a=s.reactions)||void 0===a?void 0:a[e].some(e=>e.user_name===d.user_name);return n},m=a=>{let n=p(a);n?t(a):e(a,null)};return l.createElement("div",{className:o.itemsRoot},r.map(e=>{return l.createElement(A,{key:e.id.toString(),onClick:()=>{m(`:reaction_${e.id.toString()}:`)},classes:o,item:e,active:p(`:reaction_${e.id}:`)})}))};let S=(0,r.ZP)(y.Z)(({theme:e})=>({margin:0,padding:e.spacing(0,.5),maxHeight:"48px",display:"flex",alignItems:"center",whiteSpace:"nowrap"}));function I({onEmojiClick:e,multiple:t=!0,disabled:a,scrollRef:n,scrollClose:r,placement:o="top",label:s="insert_an_emoji",control:c,identity:d,unsetReaction:p}){let{i18n:m}=(0,i.OgA)(),g=m.formatMessage({id:s}),[h,f]=l.useState(null),b=l.useRef(),[v,x]=l.useState(!1),y=l.useCallback(()=>{x(!1)},[]),w=l.useCallback(e=>{x(e=>!e),f(h?null:e.currentTarget)},[]),P=l.useCallback((a,n)=>{e&&e(a,n),t||x(!1)},[t,e]),k=l.useCallback(e=>{p&&p(e),x(!1)},[p]);return l.useEffect(()=>{if(v&&n&&n.current&&r){let e=()=>x(!1);return n.current.addEventListener("scroll",e),()=>{null==n||n.current.removeEventListener("scroll",e)}}},[v]),l.createElement(l.Fragment,null,l.createElement(u.Qn,{excludeRef:b,onClickAway:y},l.createElement(c,{onClick:w,disabled:a,title:g,"data-testid":"buttonAttachEmoji",icon:"ico-smile-o"})),l.createElement(E.Z,{ref:b,open:v,anchorEl:h,placement:o,role:"presentation",style:{zIndex:5e3}},l.createElement(S,{"data-testid":"dialogEmojiPicker"},l.createElement(M,{onEmojiClick:P,unsetReaction:k,identity:d}))))}function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let _=(0,r.ZP)(g.Z,{name:"MsgEmojiPicker",slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.75),cursor:"pointer",minWidth:e.spacing(2.5),lineHeight:e.spacing(2.5)})),z=l.forwardRef((e,t)=>{return l.createElement(_,F({className:"uiChatItemBtn uiChatIconBtn",disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0},e,{ref:t}),l.createElement(u.zb,{icon:"ico-smile-o"}))});function O({handleAction:e,scrollRef:t,identity:a}){let n=l.useCallback((t,a=null)=>e("chat/messageReaction",{shortcut:t,unicode:a}),[e]),i=l.useCallback(t=>{e("chat/unsetReaction",{identity:a,shortcut:t})},[e]);return l.createElement(I,{size:"small",multiple:!1,onEmojiClick:n,unsetReaction:i,control:z,scrollRef:t,scrollClose:!0,identity:a})}let j=(0,r.ZP)("div",{name:"MsgToolbar",slot:"uiChatToolbar",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",justifyContent:"center",alignItems:"center",...!t&&{flexDirection:"row-reverse"}}));function T({items:e,disabled:t,disableReact:a,handleAction:n,identity:r,isOwner:o}){let{useScrollRef:s}=(0,i.OgA)(),c=s();return t?null:l.createElement(j,{isOwner:o,className:"uiChatToolbar"},l.createElement(x,{identity:r,items:e,scrollRef:c,handleAction:n}),a?null:l.createElement(O,{scrollRef:c,handleAction:n,identity:r}))}let B="MsgItem",D=(0,r.ZP)("div",{name:B,slot:"uiChatMsgItem",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({...t&&{flexDirection:"row-reverse"},minHeight:"40px",marginBottom:e.spacing(.5)})),W=(0,r.ZP)("div",{name:B,slot:"uiChatMsgItemBody",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isShowReact"!==e})(({theme:e,isOwner:t,isAlert:a,isShowReact:n})=>({display:"flex","&:hover .uiChatItemBtn":{visibility:"visible"},...t&&{flexDirection:"row-reverse"},...a&&{textAlign:"center",...n&&{justifyContent:"center"}}})),H=(0,r.ZP)("div",{name:B,slot:"uiChatMsgItemBodyOuter",shouldForwardProp:e=>"hasToolbar"!==e&&"multiImage"!==e&&"isOwner"!==e&&"isPageAllMessages"!==e&&"msgType"!==e&&"msgContentType"!==e})(({theme:e,hasToolbar:t,multiImage:a,isOwner:n,isPageAllMessages:i,msgType:r,msgContentType:l})=>({maxWidth:"100%",...t&&{maxWidth:"calc(100% - 42px)"},...t&&i&&{maxWidth:"calc(65% - 42px)"},..."messageDeleted"===l&&!n&&{maxWidth:"calc(100% - 26px)"},...a&&{maxWidth:"160px"},...a&&n&&{maxWidth:"190px"},...a&&i&&{maxWidth:"400px"},...i&&("message_pinned"===r||"message_unpinned"===r)&&{maxWidth:"400px"}}));function L({msgId:e,authUser:t,showToolbar:a=!0,disableReact:r,handleAction:o}){let{jsxBackend:s,usePageParams:u,useGetItem:g}=(0,i.OgA)(),h=`chat.entities.message.${e}`,f=g(h),b=u(),v=(null==b?void 0:b.rid)||!1,[x]=(0,i.zXz)(h,{}),y=(0,c.PB)(),{id:E,type:w,attachments:P,reactions:k,created_at:C,user:Z}=f||{},R=g(Z),A=t.id===(null==R?void 0:R.id),M=(0,n.jF)(C),S=(0,n.qF)(P),I=(0,n.vS)(w),F=l.useMemo(()=>(0,p.W$)(y,{isSearch:!1,allowEdit:A,item:f,canDelete:A}),[y,!1,A,f,A]);if(!f)return null;let _=(e,t,a)=>{x(e,t,a),o(e,f,a)},z="messageDeleted"!==w;return l.createElement(D,{isOwner:A,"data-id":E,"data-t":w,"data-testid":E},l.createElement(W,{isOwner:A,isAlert:I,isShowReact:z},l.createElement(H,{hasToolbar:a,multiImage:S>1,isOwner:A,isPageAllMessages:v,msgType:w,className:(0,m.default)("uiChatMsgItemBodyOuter")},s.render({component:`chat.messageContent.${w}`,props:{message:f,isOwner:A,user:Z,createdDate:M,msgType:w,tooltipPosition:"top"}})),z&&!I&&l.createElement(T,{identity:h,handleAction:_,disabled:!a,disableReact:r,items:F,isOwner:A})),z&&l.createElement(d.Z,{identity:h,disabled:!k,reactions:k,isOwner:A,handleAction:_}))}let N="MsgSet",$=(0,r.ZP)("div",{name:N,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:a})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...a&&{"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse",padding:e.spacing(0,2)}})),U=(0,r.ZP)("div",{name:N,slot:"uiChatMsgSetAvatar",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:a})=>({marginRight:e.spacing(1),display:"flex",alignItems:"flex-end",marginBottom:e.spacing(.75),...t&&{display:"none",flexDirection:"row-reverse"},...a&&{display:"none"},"& > span":{cursor:"default"}})),Y=(0,r.ZP)("div",{name:N,slot:"uiChatMsgSetBody",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({flex:1,minWidth:0,...t&&{flexDirection:"row-reverse"}}));function G({msgSet:e,disableReact:t,handleAction:a}){let{useSession:n,useGetItem:r}=(0,i.OgA)(),{user:o}=n(),c=r(null==e?void 0:e.user);if(!e)return;let{items:d}=e,p=o.id===c.id;return d&&d.length?l.createElement($,{isOwner:p,className:`uiChatMsgSet ${p?"isOwner":""}`},l.createElement(U,{isOwner:p,className:"uiChatMsgSetAvatar"},l.createElement(s.Z,{user:c,size:32})),l.createElement(Y,{className:"uiChatMsgSetBody"},d.map((e,n)=>l.createElement(L,{authUser:o,key:e.toString(),msgId:e,disableReact:t,handleAction:a})))):null}function q({msgGroup:e,disableReact:t,handleAction:a}){if(!e)return null;let{items:n}=e;return n?l.createElement("div",null,n.map((e,n)=>l.createElement(G,{msgSet:e,key:`k.0${n}`,disableReact:t,handleAction:a}))):null}var K=a(19382);let X=(0,r.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({"&:not(:first-of-type)":{marginTop:e.spacing(.75)},position:"relative",padding:e.spacing(1),maxWidth:"245px",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},borderRadius:e.spacing(1.25),overflow:"hidden",...t&&{maxWidth:"400px",padding:e.spacing(1.25,1)}})),Q=(0,r.ZP)("div")(({theme:e})=>({display:"flex",alignItems:"center","& .ico":{marginRight:e.spacing(.75)}})),J=(0,r.ZP)(u.Ys)(({theme:e})=>({flex:1,minWidth:0,fontSize:e.mixins.pxToRem(12)})),V=(0,r.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({position:"absolute",bottom:0,left:0,right:0,padding:e.spacing(0,1),...t&&{span:{height:e.spacing(.75)}}}));var ee=function({count:e=1,files:t,progress:a=0,isAllPage:n=!1}){let{i18n:r}=(0,i.OgA)();if(t||t.length)return l.createElement(X,{isAllPage:n},l.createElement(Q,null,l.createElement(u.zb,{icon:"ico-paperclip-alt"}),l.createElement(J,{lines:1},1===e?l.createElement(l.Fragment,null,r.formatMessage({id:"uploading_name"},{name:t[0].name})):r.formatMessage({id:"uploading_n_attachments"},{count:e}))),l.createElement(V,{isAllPage:n},l.createElement(K.Z,{variant:"determinate",value:a})))};function et(){return(et=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}let ea=(0,r.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",marginBottom:e.spacing(.5),padding:e.spacing(.5,2)})),en=(0,r.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",width:"100%",...t&&{maxWidth:'calc(~"100% - 50px")'}}));var ei=function({data:e,eventInit:t,isAllPage:a=!1}){let n=Object.keys(e),i=n.map(t=>{return{id:t,...e[t]}});return(l.useEffect(()=>{t&&t()},[i]),i.length)?l.createElement(ea,null,l.createElement(en,{isAllPage:a},i.map(e=>l.createElement(ee,et({},e,{key:e.id,isAllPage:a}))))):null};let er=(0,r.ZP)("div",{name:"Messages",slot:"DateTimeGroup"})(({theme:e})=>({textAlign:"center",color:e.palette.grey["600"]}));var el=l.forwardRef(function({rid:e,groups:t,groupIds:a,newest:r,disableReact:s,room:c,containerRef:d,handleAction:p,isAllPage:m,roomProgress:u,loading:g},h){let f=(0,i.lJz)(),[b,v]=l.useState(!1),x=()=>{let e=f.current.scrollHeight+0;f.current.scrollTo({top:e})};return(l.useEffect(()=>{b&&setTimeout(()=>{x()},100)},[e,b,g]),l.useEffect(()=>{return v(!!(null==a?void 0:a.length)),()=>v(!1)},[null==a?void 0:a.length]),l.useLayoutEffect(()=>{if((null==f?void 0:f.current)&&r){let e=f.current;e.scrollHeight-e.scrollTop-110<=e.clientHeight&&x()}},[r]),l.useImperativeHandle(h,()=>{return{scrollToBottom:()=>{x()}}}),c&&t)?l.createElement(o.Provider,{value:d},a.map((e,a)=>{var i,r;return l.createElement("div",{key:`k.0${a}`},t[e]&&(0,n.jF)(null===(i=t[e])||void 0===i?void 0:i.ts)?l.createElement(er,null,(0,n.jF)(null===(r=t[e])||void 0===r?void 0:r.ts)):null,l.createElement(q,{msgGroup:t[e],disableReact:s,handleAction:p}))}),Z()(u)?null:l.createElement(ei,{data:u,eventInit:x,isAllPage:m})):null})},27937:function(e,t,a){"use strict";a.d(t,{Z:function(){return h}});var n=a(85597),i=a(81719),r=a(67294),l=a(40471),o=a(47037),s=a.n(o);let c=(0,i.ZP)("span")(({theme:e})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:e.spacing(0,.25)})),d=(0,i.ZP)("img")(({theme:e})=>({width:15,height:15}));function p({id:e,users:t=[]}){let a=(0,l.z)();if(!e||!t.length)return null;let n=s()(e)&&e.split(":")[1].split("_")[1];if(!n||!a)return null;let i=a.find(e=>e.id===parseInt(n));return r.createElement(c,null,r.createElement(d,{src:null==i?void 0:i.src,draggable:!1,alt:null==i?void 0:i.title}))}let m=(0,i.ZP)("div",{shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",margin:0,padding:0,marginBottom:e.spacing(-.25),...t&&{flexDirection:"row-reverse"}})),u=(0,i.ZP)("span")(({theme:e})=>({marginLeft:e.spacing(.5),position:"relative",top:"-1px",fontSize:e.typography.pxToRem(14),height:e.spacing(2.5),fontWeight:e.typography.fontWeightRegular})),g=(0,i.ZP)("div")(({theme:e})=>({cursor:"pointer",color:e.palette.grey["800"],backgroundColor:e.palette.grey["50"],position:"relative",borderRadius:e.spacing(1),lineHeight:e.spacing(2.5),whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",padding:e.spacing(.5,.75),boxShadow:"0px 0px 15px 0px #00000026",transform:"translateY(-10px)",height:e.spacing(3),zIndex:2}));function h({identity:e,disabled:t,reactions:a,isOwner:i,handleAction:l}){let{dispatch:o}=(0,n.OgA)(),s=()=>{o({type:"chat/presentReactionsList",payload:{identity:e}})};if(t||!a||!Object.keys(a).length)return null;let c=0,d=Object.keys(a).reduce((e,t)=>{var n;return c+=null===(n=a[t])||void 0===n?void 0:n.length,{...e,[t]:a[t]}},{});return r.createElement(m,{isOwner:i},r.createElement(g,{onClick:s},Object.keys(d).slice(0,3).map((e,t)=>r.createElement(p,{id:e,users:d[e],key:`k${t}`})),r.createElement(u,null,c)))}}}]);