(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chat-components-ChatRoomPanel-Block"],{30998:function(e,t,n){var a=n(41848),i=n(67206),r=n(40554),l=Math.max;e.exports=function(e,t,n){var o=null==e?0:e.length;if(!o)return -1;var s=null==n?0:r(n);return s<0&&(s=l(o+s,0)),a(e,i(t,3),s)}},87229:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var a=n(41547),i=n(81719),r=n(67294),l=n(30120);let o="PreviewUploadFile",s=(0,i.ZP)("img",{name:o,slot:"previewImage"})(({theme:e})=>({borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",marginRight:e.spacing(2),objectFit:"cover"})),c=(0,i.ZP)("div",{name:o,slot:"PreviewFile",shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({borderRadius:e.spacing(1),maxWidth:"150px",width:"150px",height:"52px",marginRight:e.spacing(2),fontSize:e.spacing(1.5),display:"flex",alignItems:"center",background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],...t&&{maxWidth:"180px",width:"180px",overflowX:"hidden"}})),d=(0,i.ZP)("div",{name:o,slot:"IconFile"})(({theme:e})=>({borderRadius:"100%",maxWidth:"28px",width:"28px",height:"28px",margin:e.spacing(0,1),padding:e.spacing(0,1),color:e.palette.default.contrastText,background:"light"===e.palette.mode?e.palette.grey["500"]:e.palette.grey["700"],display:"inline-flex",justifyContent:"center",alignItems:"center"})),p=(0,i.ZP)("div",{name:o,slot:"closeButton"})(({theme:e})=>({position:"absolute",top:"-8px",right:"8px",cursor:"pointer",width:e.spacing(2.5),height:e.spacing(2.5),backgroundColor:e.palette.grey["500"],borderRadius:"50%",fontSize:e.mixins.pxToRem(8),justifyContent:"center",alignItems:"center",display:"inline-flex",opacity:.8,color:(e.palette.mode,e.palette.text.primary),"&:hover":{backgroundColor:e.palette.background.default,color:e.palette.text.primary,border:e.mixins.border("secondary")}})),u=(0,i.ZP)(a.Ys)(({theme:e})=>({paddingRight:e.spacing(1),wordBreak:"break-word",p:{fontSize:e.mixins.pxToRem(13)}}));var m=function({onRemove:e,file:t,isAllPage:n}){let i=t.type,o=["image/gif","image/jpeg","image/png"].includes(i),m=o?URL.createObjectURL(t):"";return r.createElement(l.Z,{display:"inline-flex",position:"relative"},o?r.createElement(s,{src:m,alt:"Preview"}):r.createElement(c,{isAllPage:n},r.createElement(d,null,r.createElement(a.zb,{icon:"ico-paperclip-alt"})),r.createElement(u,{lines:2},t.name)),r.createElement(l.Z,{position:"absolute",top:1,right:1},r.createElement(p,{"data-testid":"buttonRemove",onClick:e,"aria-label":"Close"},r.createElement(a.zb,{icon:"ico-close"}))))};let g=(0,i.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({background:e.palette.background.paper,padding:e.spacing(2,1,0,1),display:"flex",overflow:"hidden",borderTop:e.mixins.border("secondary"),userSelect:"none",height:"85px",minHeight:"85px",...t&&{height:"90px",minHeight:"90px"}})),h=(0,i.ZP)("div")(({theme:e})=>({display:"flex",overflowX:"auto",paddingTop:e.spacing(1),marginBottom:e.spacing(.5),paddingBottom:e.spacing(.5),"&::-webkit-scrollbar":{height:"5px",width:"5px",background:"transparent",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{margin:e.spacing(.5,0),borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:e.palette.grey["700"],borderRadius:"10px"}})),f=(0,i.ZP)("div",{slot:"ButtonAdd"})(({theme:e})=>({marginRight:e.spacing(1),cursor:"pointer",span:{background:"light"===e.palette.mode?e.palette.background.default:e.palette.grey["500"],"&:hover":{background:e.palette.action.hover},borderRadius:e.spacing(1),maxWidth:"52px",width:"52px",height:"52px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:e.spacing(2.5)}}));var v=r.forwardRef(function({filesUploadRef:e,isAllPage:t},n){let[i,l]=r.useState([]),[o,s]=r.useState("image"),c=r.useRef(),d=r.useRef(),p=t=>{let n=[...i];if(t>-1&&(n.splice(t,1),l([...n]),e)){var a;null===(a=e.current)||void 0===a||a.removeFile(t)}};if(r.useImperativeHandle(n,()=>{return{attachFiles:e=>{(null==e?void 0:e.length)&&l(e)},typeUpload:e=>{e&&s(e)},clear:()=>{l([])},checkIsLoading:()=>{}}}),!i||!(null==i?void 0:i.length))return null;let u=()=>{c.current.click()},v=()=>{d.current.click()},b=()=>{if("image"===o){u();return}v()},x=()=>{if(!c.current.files.length)return;let t=[...i,...c.current.files];if(l(t),e){var n;null===(n=e.current)||void 0===n||n.attachFiles(t)}},y=()=>{if(!d.current.files.length)return;let t=[...i,...d.current.files];if(l(t),e){var n;null===(n=e.current)||void 0===n||n.attachFiles(t)}};return r.createElement(g,{isAllPage:t},r.createElement(h,null,Object.values(i).map((e,n)=>r.createElement(m,{key:n,file:e,onRemove:()=>p(n),isAllPage:t})),r.createElement(f,{onClick:b},r.createElement("span",null,r.createElement(a.zb,{icon:"ico-text-file-plus"})))),r.createElement("input",{"data-testid":"inputAttachPhoto",onChange:x,multiple:!0,ref:c,style:{display:"none"},type:"file",accept:"image/*"}),r.createElement("input",{style:{display:"none"},type:"file",multiple:!0,ref:d,onChange:y}))})},46781:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return es}});var a=n(85597),i=n(37344),r=n(21241),l=n(41547),o=n(81719),s=n(62097),c=n(30120),d=n(35705),p=n(67294),u=n(10159),m=n(13478),g=n(21822),h=n(81674),f=n(23279),v=n.n(f);let b=(0,o.ZP)("div")(()=>({width:"100%"})),x=(0,o.ZP)(h.ZP,{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({maxWidth:"600px",height:e.spacing(5),margin:e.spacing(2),padding:e.spacing(1.5,2),borderRadius:e.spacing(2.5),border:e.mixins.border("secondary"),backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.grey["100"],...t&&{margin:0,width:"100%",padding:e.spacing(0,1),"& input":{padding:e.spacing(.25,1,0,1)}}})),y=(0,o.ZP)(l.zb,{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({color:e.palette.text.primary,transition:"all .2s ease",cursor:"pointer",...t&&{padding:e.spacing(1)}}));(0,o.ZP)("div",{shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:e.palette.grey["600"],marginRight:e.spacing(1.5),...t&&{marginRight:e.spacing(.75)}})),(0,o.ZP)("span")(({theme:e})=>({marginRight:e.spacing(0,.25),color:e.palette.text.primary}));var E=function({toggleSearch:e,room:t,searching:n}){let{i18n:i,dispatch:r,useIsMobile:l}=(0,a.OgA)(),o=l(),s=p.useRef();p.useEffect(()=>{s.current="",u()},[n]);let c=e=>{s.current=e.target.value,u()},d=p.useCallback(()=>{r({type:"chat/room/searchMessages",payload:{roomId:null==t?void 0:t.id,text:s.current},meta:{}})},[r,t]),u=p.useMemo(()=>{return v()(d,200)},[d]);return o?p.createElement(b,null,p.createElement(x,{isMobile:o,startAdornment:p.createElement(y,{icon:"ico-search-o",isMobile:o}),endAdornment:p.createElement(y,{icon:"ico-close",onClick:e}),placeholder:i.formatMessage({id:"search_this_conversation"}),autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off"},inputRef:s,onChange:c})):p.createElement(b,null,p.createElement(x,{startAdornment:p.createElement(y,{icon:"ico-search-o"}),endAdornment:p.createElement(y,{icon:"ico-close",onClick:e}),placeholder:i.formatMessage({id:"search_this_conversation"}),autoComplete:"off",inputProps:{"aria-label":"search","data-testid":"searchBox",autoComplete:"off",autoCapitalize:"off"},inputRef:s,onChange:c}))};let w=(0,o.ZP)("div",{shouldForwardProp:e=>"isMobile"!==e&&"openSearch"!==e})(({theme:e,isMobile:t,openSearch:n})=>({backgroundColor:e.palette.background.paper,alignItems:"center",boxSizing:"border-box",display:"flex",height:e.spacing(9),padding:e.spacing(1,1,1,2),justifyContent:"space-between",borderBottom:e.mixins.border("secondary"),...t&&!n&&{padding:e.spacing(1,.5,1,1)}})),P=(0,o.ZP)("div")(({theme:e})=>({})),k=(0,o.ZP)("div")(({theme:e})=>({padding:e.spacing(1.75,0),display:"flex",alignItems:"center",cursor:"pointer"})),C=(0,o.ZP)("span")(({theme:e})=>({...e.typography.h4,margin:e.spacing(0,1.5,0,2)})),Z=(0,o.ZP)(g.Z,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,fontSize:e.spacing(2.25),minWidth:e.spacing(6.25),...t&&{color:e.palette.primary.main},padding:0,margin:0})),R=(0,o.ZP)("div")(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center"})),A=(0,o.ZP)("div")(({theme:e})=>({flex:1,display:"flex",alignItems:"center",justifyContent:"space-between"})),M=(0,o.ZP)(g.Z,{shouldForwardProp:e=>"isInfo"!==e})(({theme:e,isInfo:t})=>({color:"light"===e.palette.mode?e.palette.grey["600"]:e.palette.text.primary,fontSize:e.spacing(2.25),minWidth:e.spacing(4),...t&&{color:e.palette.primary.main}}));var S=function({room:e,searching:t}){let{dispatch:n,useActionControl:r,useIsMobile:o,navigate:s,useGetItem:c}=(0,a.OgA)(),d=o(),[g,h]=p.useState(!1),f=(null==e?void 0:e.other_members[0])||void 0,v=c(f),[b]=r(null==e?void 0:e.id,{}),x=(t,a,i)=>{b(t,a,i),"chat/room/toggleSearching"===t&&(n({type:"chat/room/searchMessages",payload:{roomId:null==e?void 0:e.id,text:""}}),h(e=>!e))},y=(0,u.Mn)(),S=p.useMemo(()=>(0,m.W$)(y,{isMobile:d}),[y,d]);p.useEffect(()=>{h(!1)},[e]);let I=p.useCallback(()=>{n({type:"chat/room/toggleSearching",payload:{identity:null==e?void 0:e.id}}),n({type:"chat/room/searchMessages",payload:{roomId:null==e?void 0:e.id,text:""}}),h(e=>!e)},[n,e]),F=()=>{s({pathname:"/messages"})};return d?p.createElement(w,{isMobile:d,openSearch:g},g?null:p.createElement(Z,{onClick:F},p.createElement(l.zb,{icon:"ico-arrow-left"})),g?p.createElement(E,{toggleSearch:I,room:e,searching:t}):p.createElement(A,null,p.createElement(k,null,p.createElement(l.Yt,{user:v,size:48}),p.createElement(C,null,null==e?void 0:e.name)),p.createElement(P,null,p.createElement(R,null,p.createElement(i.BB,{items:S,handleAction:x,displayLimit:2}))))):p.createElement(w,null,p.createElement(k,null,e?p.createElement(l.Yt,{user:v,size:48}):null,p.createElement(C,null,null==e?void 0:e.name)),p.createElement(P,null,g?p.createElement(E,{toggleSearch:I,room:e,searching:t}):p.createElement(R,null,p.createElement(M,{onClick:I},p.createElement(l.zb,{icon:"ico-search-o"})),p.createElement(i.BB,{items:S,handleAction:b,variant:"pageMessage"}))))},I=n(1469),F=n.n(I);let z="ChatRoomPanel",_=(0,o.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"column",borderLeft:e.mixins.border("secondary"),backgroundColor:e.palette.background.paper,width:"100%",height:"100%"})),O=(0,o.ZP)("div",{name:z,slot:"mainContent"})(({theme:e})=>({display:"flex",flexDirection:"row",alignItems:"center",borderBottom:e.mixins.border("secondary")})),j=(0,o.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"row",backgroundColor:e.palette.background.paper,flex:1})),T=(0,o.ZP)("div")(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",width:"100%",minWidth:0})),B=(0,o.ZP)("div",{name:z,slot:"Title"})(({theme:e})=>({fontSize:e.spacing(1.875),padding:e.spacing(3.5,2),fontWeight:e.typography.fontWeightMedium,alignSelf:"flex-start",color:e.palette.text.secondary,minWidth:"130px"})),D=(0,o.ZP)("div",{name:z,slot:"SearchWrapper"})(({theme:e})=>({flex:1,minWidth:0,margin:e.spacing(1),position:"relative",zIndex:e.zIndex.speedDial})),W=(0,o.ZP)("div",{name:z,slot:"WrapperSuggest",shouldForwardProp:e=>"suggestList"!==e})(({theme:e,suggestList:t})=>({...!0===t&&{position:"absolute",width:"100%",border:e.mixins.border("secondary"),borderTop:"none",backgroundColor:e.palette.background.paper,borderEndEndRadius:e.spacing(1),borderEndStartRadius:e.spacing(1)}})),H=(0,o.ZP)("div")(({theme:e})=>({padding:e.spacing(1.75,2),display:"flex",alignItems:"center",cursor:"pointer",borderBottom:e.mixins.border("secondary"),"&:last-child":{borderBottom:"none"}})),L=(0,o.ZP)("span")(({theme:e})=>({...e.typography.h5,marginLeft:e.spacing(1)}));var N=function(){let{i18n:e,dispatch:t,apiClient:n}=(0,a.OgA)(),o=p.useRef(""),[s,c]=p.useState(""),[d,u]=p.useState(!1),[m,g]=p.useState([]),h=p.useMemo(()=>{let e=()=>{n.get("/friend",{params:{limit:10,q:o.current||void 0}}).then(e=>e.data.data).then(e=>F()(e)&&g(e)).catch(e=>{})};return v()(e,200)},[n,o.current]);p.useEffect(()=>{h()},[]);let f=p.useCallback(e=>{t({type:"chat/newChatRoom",payload:{user:e,isPage:!0}})},[]),b=p.useCallback(e=>{},[]),x=p.useCallback(e=>{var t;let n=null===(t=e.currentTarget)||void 0===t?void 0:t.value;o.current=n,c(n),h(),u(!0)},[]),y=()=>{u(!1)};return p.createElement(_,null,p.createElement(O,null,p.createElement(B,null,e.formatMessage({id:"new_message"})),p.createElement(l.Qn,{onClickAway:y},p.createElement(D,null,p.createElement(i.zj,{sx:{p:0},valueSearch:s,onChangeSearch:x,onKeyUp:b,placeholder:e.formatMessage({id:"type_name_start_new_conversation"}),size:30,isShowButtonSubmit:!1}),d?p.createElement(W,{suggestList:Boolean(m&&m.length)},p.createElement("div",null,p.createElement(r.l$,{autoHide:!0,autoHeight:!0},m.map((e,t)=>p.createElement(p.Fragment,{key:t},p.createElement(H,{onClick:()=>f(e)},p.createElement(l.Yt,{user:e,size:32,noLink:!0}),p.createElement(L,null,e.full_name))))))):null))),p.createElement(j,null,p.createElement(T,null)))},$=n(41609),U=n.n($),Y=n(38779),G=n(48309),q=n(40263),K=n(87229);let X="ChatRoomPanel",Q=(0,o.ZP)("div",{name:X,slot:"root",shouldForwardProp:e=>"loading"!==e})(({theme:e,loading:t})=>({borderLeft:e.mixins.border("secondary"),backgroundColor:e.palette.background.paper,display:"flex",flexDirection:"row",width:"100%",height:"100%","& .MuiAvatar-root":{fontSize:e.mixins.pxToRem(14)}})),J=(0,o.ZP)("div",{name:X,slot:"mainContent"})(({theme:e})=>({flex:1,display:"flex",width:"100%",height:"100%"})),V=(0,o.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"row",width:"100%",flex:1,minHeight:0})),ee=(0,o.ZP)("div",{name:X,slot:"Main",shouldForwardProp:e=>"isMobile"!==e})(({theme:e,isMobile:t})=>({flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"})),et=(0,o.ZP)("div")(({theme:e})=>({textAlign:"center",padding:e.spacing(2),fontStyle:"italic",color:"dark"===e.palette.mode?e.palette.text.primary:e.palette.grey["700"],fontSize:e.spacing(1.75)})),en=(0,o.ZP)("div",{name:X,slot:"ReplyEditWrapper"})(({theme:e})=>({padding:e.spacing(.625,1.25),height:"50px",width:"100%",borderTop:e.mixins.border("secondary"),display:"flex",justifyContent:"space-between",backgroundColor:"dark"===e.palette.mode?e.palette.grey["600"]:e.palette.grey["100"]})),ea=(0,o.ZP)(l.Ys,{name:X,slot:"SelectedMsg"})(({theme:e})=>({color:e.palette.text.primary})),ei=(0,o.ZP)(l.zb,{name:X,slot:"LineIconClose"})(({theme:e})=>({cursor:"pointer",alignSelf:"center"})),er=(0,o.ZP)("div",{name:X,slot:"SelectedMsgAttachment"})(({theme:e})=>({fontSize:e.spacing(1.5),margin:e.spacing(.5,0),"& .ico":{marginRight:e.spacing(.5)}})),el=(0,o.ZP)("div",{name:X,slot:"ContentWrapper"})(({theme:e})=>({overflow:"hidden"})),eo=(0,o.ZP)("div",{name:X,slot:"LoadingStyled"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",marginTop:e.spacing(3)}));var es=(0,a.j4Z)({name:"ChatRoomPanel",extendBlock:function(e){var t;let{i18n:n,jsxBackend:o,usePageParams:m,useActionControl:g,dispatch:h,useIsMobile:f}=(0,a.OgA)(),v=m(),{rid:b}=v,x=f(),y=p.useRef(),E=p.useRef(),w=p.useRef(),P=p.useRef(),k=(0,u.pB)(b),[C]=g(b,{}),[Z,R]=(0,p.useState)("no_react"),[A,M]=(0,p.useState)(),[I,F]=(0,p.useState)(void 0),[z,_]=(0,p.useState)(!1),O=(0,s.Z)(),j=null==k?void 0:k.searching,T=o.get("ChatSimpleComposer"),B=()=>{R("no_react"),M(void 0)},D=p.useCallback(()=>{b&&h({type:"chat/room/markAsRead",payload:{identity:b}})},[b,h]);p.useEffect(()=>{return b&&(_(!0),h({type:"chat/room/markAsRead",payload:{identity:b}}),h({type:"chat/room/active",payload:b,meta:{onSuccess:e=>{F(e),_(!1)},onFailure:()=>{_(!1)}}})),()=>{h({type:"chat/room/inactive",payload:{rid:b}}),h({type:"chat/room/closeSearching",payload:{identity:b}}),B(),F(void 0)}},[b]);let W=null==k?void 0:k.messageFilter,H={backgroundColor:O.palette.background.paper},L=p.useMemo(()=>{return(null==A?void 0:A.message)?(0,q.Hj)(null==A?void 0:A.message):""},[A]);if(!b&&!x&&!I)return p.createElement(N,null);let $=(e,t)=>{if(!e)return;let n=e.split(/.,| /);n.forEach(e=>{switch(e){case"chat/replyMessage":R("reply"),M(t);break;case"chat/editMessage":R("edit"),M(t)}})},X=()=>{B(),(null==P?void 0:P.current)&&P.current.scrollToBottom()};return p.createElement(Q,{loading:z||!I&&b},p.createElement(J,null,p.createElement(V,null,p.createElement(ee,{isMobile:x},p.createElement(S,{room:I,searching:j}),p.createElement(c.Z,{sx:{flex:1,minHeight:0}},p.createElement(r.l$,{autoHeight:!0,autoHeightMax:"100%",ref:y,style:H},j||z?null:p.createElement(et,null,n.formatMessage({id:"start_of_conversation"})),z&&p.createElement(eo,{"data-testid":"loadingIndicator"},p.createElement(d.Z,{size:24})),j&&W?p.createElement(c.Z,{sx:{mt:2}},p.createElement(G.Z,{items:W,room:I,disableReact:!0,handleAction:C})):p.createElement(Y.Z,{rid:b,groups:null==k?void 0:k.groups,groupIds:null==k?void 0:k.groupIds,newest:null==k?void 0:k.newest,room:I,containerRef:y,disableReact:!1,handleAction:$,ref:P,loading:z,roomProgress:null==k?void 0:k.roomProgress,isAllPage:!0}))),"no_react"!==Z&&p.createElement(en,null,p.createElement(el,null,p.createElement("div",null,"reply"===Z?n.formatMessage({id:"reply_to_user_at_timestamp"},{user:null==A?void 0:null===(t=A.user)||void 0===t?void 0:t.full_name,time:new Date(A.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}):n.formatMessage({id:"editing"})),U()(null==A?void 0:A.attachments)?p.createElement(ea,{lines:1,dangerouslySetInnerHTML:{__html:L}}):p.createElement(er,null,p.createElement(l.zb,{icon:"ico-paperclip-alt"}),p.createElement("span",null,n.formatMessage({id:"file_attachment"})))),p.createElement(ei,{icon:"ico-close",onClick:()=>R("no_react")})),p.createElement(K.Z,{ref:E,filesUploadRef:w,isAllPage:!0}),p.createElement(i.jH,{searching:j},p.createElement(T,{rid:b,msgId:null==A?void 0:A.id,reactMode:Z,text:"edit"===Z?L:"",onSuccess:X,previewRef:E,ref:w,isAllPage:!0,onMarkAsRead:D}))))))}})},37344:function(e,t,n){"use strict";n.d(t,{zj:function(){return m},s_:function(){return A},KG:function(){return h},jH:function(){return E},V9:function(){return P},pY:function(){return U},BB:function(){return X},ay:function(){return L}});var a,i,r=n(41547),l=n(30120),o=n(21822),s=n(81719),c=n(67294);let d=(0,s.ZP)("div",{name:"ChatDockFilter"})(({theme:e})=>({position:"relative"})),p=(0,s.ZP)(l.Z,{name:"ChatDockFilter"})(({theme:e})=>({padding:e.spacing(1,1,1,2),display:"flex",flexDirection:"row",alignItems:"center"})),u=(0,s.ZP)(o.Z,{name:"ChatDockFilter"})(({theme:e})=>({marginLeft:e.spacing(.5)}));function m({placeholder:e,size:t,hide:n,label:a,disabled:i,valueSearch:l,onChangeSearch:o,onKeyUp:s,onSubmit:m,variant:g="direct",isShowButtonSubmit:h=!0,sx:f}){return n?null:c.createElement(d,null,c.createElement(p,{sx:f},c.createElement(r.Rj,{placeholder:e,onKeyUp:s,value:l,onChange:o}),h&&m?c.createElement(u,{disabled:i,size:"medium",color:"primary",variant:"text",onClick:m},a):null))}let g=(0,s.ZP)("div",{name:"ChatDockContent",slot:"root",shouldForwardProp:e=>"searching"!==e&&"collapsed"!==e})(({theme:e,searching:t,collapsed:n})=>({flex:1,maxHeight:"100%",position:"relative",paddingBottom:e.spacing(.75),...t&&{borderTop:"none"},...n&&{display:"none"},"&::-webkit-scrollbar":{height:"5px",width:"5px",background:"gray",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}}));var h=c.forwardRef(function({children:e,searching:t,collapsed:n},a){return c.createElement(g,{ref:a,searching:t,collapsed:n},e)}),f=n(85597);let v="ChatDockFooter",b=(0,s.ZP)("div",{name:v,slot:"root",shouldForwardProp:e=>"isAllPageMessages"!==e})(({theme:e,isAllPageMessages:t})=>({position:"relative",display:"flex",minHeight:e.spacing(5),zIndex:2,backgroundColor:e.palette.background.paper,borderTop:e.mixins.border("secondary"),...t&&{minHeight:e.spacing(6)}})),x=(0,s.ZP)("div",{name:v,slot:"uiChatRoomFooter",shouldForwardProp:e=>"disable"!==e&&"isAllPageMessages"!==e})(({theme:e,disable:t,isAllPageMessages:n})=>({position:"relative",borderTop:e.mixins.border("secondary"),display:"flex",alignItems:"flex-end",minHeight:e.spacing(5),zIndex:2,flexFlow:"wrap",justifyContent:"center",...t&&{userSelect:"none",backgroundColor:"dark"===e.palette.mode?e.palette.grey["700"]:e.palette.background.paper},...n&&{minHeight:e.spacing(6)}})),y=(0,s.ZP)("div",{name:v,slot:"uiChatComposerContainer"})(({theme:e})=>({textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",padding:"4px 8px",color:e.palette.grey["500"]}));function E({children:e,archived:t,isReadOnly:n,isMuted:a,searching:i}){let{i18n:r,usePageParams:l}=(0,f.OgA)(),o=l(),s=(null==o?void 0:o.isAllPageMessages)||!1;return i?null:t?c.createElement(x,{disable:!0,isAllPageMessages:s},c.createElement(y,null,r.formatMessage({id:"this_group_is_archived"}))):n?c.createElement(x,{disable:!0,isAllPageMessages:s},c.createElement(y,null,r.formatMessage({id:"this_group_is_readonly"}))):a?c.createElement(x,{disable:!0,isAllPageMessages:s},c.createElement(y,null,r.formatMessage({id:"you_have_been_muted_in_this_group"}))):c.createElement(b,{isAllPageMessages:s},e)}let w=(0,s.ZP)("div",{shouldForwardProp:e=>"searching"!==e&&"addNewMembers"!==e})(({theme:e,searching:t,addNewMembers:n})=>({display:"flex",alignItems:"center",minHeight:e.spacing(7),padding:e.spacing(1.5,1.25,1.5,2),borderBottom:e.mixins.border("secondary"),...(t||n)&&{borderBottom:"none"}}));function P({children:e,onClick:t,searching:n,addNewMembers:a}){let i=c.useCallback(e=>{e.preventDefault(),t&&t()},[t]);return c.createElement(w,{onClick:i,searching:n,addNewMembers:a},e)}let k="ChatDockPanel",C=(0,s.ZP)("div",{name:k,slot:"Root"})(({theme:e})=>({display:"flex",alignItems:"flex-end",marginLeft:e.spacing(2),width:"328px",zIndex:999})),Z=(0,s.ZP)("div",{name:k,slot:"PanelStyled"})(({theme:e})=>({display:"flex",flexDirection:"column",zIndex:10,backgroundColor:e.mixins.backgroundColor("paper"),borderTopLeftRadius:"4px",borderTopRightRadius:"4px",boxShadow:"0 0 4px 0 rgba(0,0,0,0.2)",wordBreak:"break-word",wordWrap:"break-word",borderStartStartRadius:e.spacing(1),borderStartEndRadius:e.spacing(1),height:"455px",maxHeight:"calc(100vh - 60px)"})),R=(0,s.ZP)("div",{name:k,slot:"StageStyled"})(({theme:e})=>({width:"100%"}));var A=c.forwardRef(function({children:e},t){return c.createElement(C,{ref:t},c.createElement(R,null,c.createElement(Z,null,e)))}),M=n(81674),S=n(86010),I=n(23279),F=n.n(I),z=n(22410),_=n(73327),O=(0,z.Z)(e=>(0,_.Z)({optionLabel:{width:"32px",height:"32px",display:"inline-flex",alignItems:"center",justifyContent:"center",margin:"0",color:"#a2a2a2"},optionChecked:{color:e.palette.primary.main},optionInput:{display:"none"},optionIcon:{display:"inline-flex",alignItems:"center",marginTop:"1px",height:"14px",marginRight:"4px"}}),{name:"ChatDockSearchFilter"});let j=(0,s.ZP)("div")(({theme:e})=>({})),T=(0,s.ZP)("div")(({theme:e})=>({display:"inline-flex"})),B=(0,s.ZP)(M.ZP)(({theme:e})=>({display:"flex",width:"100%","&.Mui-focused":{borderColor:e.palette.primary.main}})),D=(0,s.ZP)(l.Z,{name:"SearchBox",slot:"Root"})(({theme:e})=>({margin:e.spacing(0,2,1,2),height:e.spacing(5),borderRadius:e.spacing(2.5),display:"flex",alignItems:"center",backgroundColor:e.palette.action.hover}));function W({id:e,checked:t,icon:n,classes:a,value:i,roomId:l,onClick:o}){let{dispatch:s}=(0,f.OgA)(),d=()=>{s({type:i,payload:{identity:l}}),"function"==typeof o&&o(t?void 0:e)};return c.createElement("label",{className:(0,S.default)(a.optionLabel,t&&a.optionChecked)},c.createElement("input",{className:a.optionInput,type:"checkbox"}),c.createElement(r.zb,{icon:n,className:a.optionIcon,onClick:d}))}let H=({placeholder:e,size:t,hide:n,options:a=[],roomId:i,searching:o=!1})=>{let s=O(),{dispatch:d}=(0,f.OgA)(),p=(0,c.useRef)(null),u=(0,c.useRef)(null);(0,c.useEffect)(()=>{p.current="",u.current=null,v()},[o]);let m=e=>{p.current=e.target.value,v()},g=e=>{u.current=e,v()},h=(0,c.useCallback)(()=>{d({type:"chat/room/searchMessages",payload:{roomId:i,text:p.current}})},[d,i]),v=(0,c.useMemo)(()=>{return F()(h,200)},[h]);return((0,c.useEffect)(()=>{var e;a.length&&(u.current=null===(e=a.find(e=>e.checked))||void 0===e?void 0:e.id)},[a]),n)?null:c.createElement(j,null,c.createElement(D,null,c.createElement(B,{variant:"search",onChange:m,placeholder:e,startAdornment:c.createElement(r.zb,{icon:"ico-search-o"}),"aria-controls":"search_complete",endAdornment:c.createElement(l.Z,null,a&&a.length?c.createElement(T,null,a.map(e=>{return c.createElement(W,{id:e.id,key:e.id.toString(),checked:null==e?void 0:e.checked,classes:s,icon:e.icon,value:e.value,roomId:i,onClick:g})})):null)})))};var L=(0,c.memo)(H);(a=i||(i={})).Direct="d",a.Private="p",a.Public="c",a.OnlyUser="u",n(71682);let N=(0,s.ZP)("div")(({theme:e})=>({flex:1,fontWeight:"bold",display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"})),$=(0,s.ZP)("span",{shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t,type:n})=>({...e.typography.subtitle1,fontSize:"15px",lineHeight:e.spacing(2.375),...n===i.Direct&&{":hover":{cursor:"pointer",textDecoration:"underline"}},..."new_message"===t&&{fontSize:e.typography.pxToRem(18),":hover":{cursor:"auto",textDecoration:"none"}}}));function U({room:e,children:t,status:n,user:a,variant:r,isSelfChat:l=!1,loading:o=!1}){let{navigate:s}=(0,f.OgA)(),d=()=>{let t=a&&(a.username||a.user_name);(null==e?void 0:e.t)===i.Direct&&t&&s(`/${t}`)};return(null==e?void 0:e.t)===i.Direct?c.createElement(N,null,c.createElement($,{onClick:d,type:null==e?void 0:e.t},t)):c.createElement(N,null,c.createElement($,{type:null==e?void 0:e.t,variant:r},t))}var Y=n(30998),G=n.n(Y),q=(0,z.Z)(e=>(0,_.Z)({root:{display:"flex",padding:"0",margin:"0",listStyle:"none"},item:{position:"relative",lineHeight:"34px",padding:"0",margin:"0",".panelHeader &":{height:"30px",width:"30px",marginLeft:e.spacing(.5)},".panelHeader &:hover button":{color:e.palette.text.secondary,backgroundColor:e.palette.action.selected,borderRadius:"50%"}},btn:{height:"34px",lineHeight:"20px",fontSize:"17px",padding:"0 6px",cursor:"pointer",color:e.palette.text.hint,position:"relative",minWidth:e.spacing(3),display:"inline-flex",textAlign:"center",alignItems:"center",justifyContent:"center",border:"none",outline:"none",backgroundColor:"transparent",".panelHeader &":{height:"30px",width:"30px"}},itemActive:{},btnActive:{color:e.palette.primary.main}}),{name:"ChatDockToolbar"});let K=(0,s.ZP)("div",{name:"ToolbarChat",slot:"root",shouldForwardProp:e=>"variant"!==e})(({theme:e,variant:t})=>({display:"flex",padding:"0",margin:"0",listStyle:"none","& .MuiActionMenu-menu":"roomPanel"===t&&{overflow:"auto",maxHeight:"200px","&::-webkit-scrollbar":{height:"5px",width:"5px",background:"transparent",borderRadius:e.spacing(.5),transition:"opacity 200ms"},"&::-webkit-scrollbar-track":{margin:e.spacing(.5,0),borderRadius:e.spacing(.5),background:"light"===e.palette.mode?"white":e.palette.grey["300"]},"&::-webkit-scrollbar-thumb":{background:e.palette.grey["600"],borderRadius:e.spacing(.5)},"&::-webkit-scrollbar-thumb:hover":{background:e.palette.grey["700"]},"&::-webkit-scrollbar-thumb:horizontal":{background:"#000",borderRadius:"10px"}}}));function X({items:e,displayLimit:t=2,variant:n=null,handleAction:a}){var i,l,o;let s=q();if(!Array.isArray(e))return null;if("roomPanel"===n){let d=t-1,p=e.filter((e,t)=>{return t<d||e.behavior}),u=G()(p,{behavior:"more"});if(u>-1){if(null===(i=p[u].items)||void 0===i?void 0:i.length)p[u].as="dropdown";else{let m=e.filter((e,t)=>t>d-1&&!e.behavior);p[u]={...p[u],items:m,as:"dropdown"}}}return c.createElement(K,{variant:n},c.createElement(r.sd,{items:p,prefixName:"chatplusToolbar.item.",fallbackName:"button",classes:s,handleAction:a}))}if("pageMessage"===n){let g=e.filter((e,t)=>{return e.behavior}),h=G()(g,{behavior:"more"});if(h>-1){if(null===(l=g[h].items)||void 0===l?void 0:l.length)g[h].as="dropdown";else{let f=e.filter((e,t)=>!e.behavior);g[h]={...g[h],items:f,as:"dropdown"}}}return c.createElement(K,{variant:n},c.createElement(r.sd,{items:g,prefixName:"chatplusToolbar.item.",fallbackName:"button",classes:s,handleAction:a,variant:n}))}let v=e.filter((e,n)=>n<t-1||e.behavior),b=G()(v,{behavior:"more"});if(b>-1){if(null===(o=v[b].items)||void 0===o?void 0:o.length)v[b].as="dropdown";else{let x=e.filter((e,n)=>n>t-2&&!e.behavior);v[b]={...v[b],items:x,as:"dropdown"}}}return c.createElement(K,null,c.createElement(r.sd,{items:v,prefixName:"chatplusToolbar.item.",fallbackName:"button",classes:s,handleAction:a}))}},48309:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var a=n(85597),i=n(81719),r=n(41609),l=n.n(r),o=n(67294),s=n(98251),c=n(2475),d=n(86010),p=n(27937);let u=(0,i.ZP)("div",{name:"MsgItemFilter",slot:"uiChatMsgItemBody"})(({theme:e})=>({display:"flex"}));function m({msgId:e,tooltipPosition:t="top",showToolbar:n=!0,room:i,disableReact:r,handleAction:l}){let{jsxBackend:s,useSession:m,useGetItem:g,useActionControl:h}=(0,a.OgA)(),f=`chat.chatRooms.${null==i?void 0:i.id}.messageFilter.${e}`,v=g(f),{user:b}=m(),[x]=h(f,{});if(!v)return;let{id:y,attachments:E,reactions:w,type:P,created_at:k,user:C}=v||{},Z=(null==b?void 0:b.id)===(null==C?void 0:C.id),R=(0,c.jF)(k),A=(0,c.qF)(E),M=(e,t,n)=>{x(e,t,n),l(e,v,n)};return o.createElement("div",{className:"uiChatMsgItem","data-id":y,"data-t":P},o.createElement(u,null,o.createElement("div",{className:(0,d.default)("uiChatMsgItemBodyOuter",{hasToolbar:n,"multi-image":A>1})},s.render({component:`chat.messageContent.${P}`,props:{message:v,isOwner:Z,user:C,createdDate:R,msgType:P,tooltipPosition:t}}))),o.createElement(p.Z,{identity:f,disabled:r,reactions:w,handleAction:M}))}let g="MessageFilter",h=(0,i.ZP)("div",{name:g,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isGroup"!==e})(({theme:e,isOwner:t,isAlert:n,isGroup:a})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...n&&{"&.uiChatMsgSetAvatar":{display:"none"},"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse"}})),f=(0,i.ZP)("div",{name:g,slot:"uiChatMsgSetAvatar"})(({theme:e})=>({marginRight:e.spacing(1)})),v=(0,i.ZP)("div",{name:g,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"]})),b=({disableReact:e,room:t,items:n,handleAction:i})=>{let{i18n:r}=(0,a.OgA)();return l()(n)?o.createElement(v,null,r.formatMessage({id:"no_items_found"})," "):o.createElement("div",null,n&&Object.values(n).map(n=>o.createElement(h,{key:n.id.toString()},o.createElement(f,null,o.createElement(s.Z,{user:n.user,size:32})),o.createElement(m,{msgId:n.id,disableReact:e,room:t,handleAction:i}))))};var x=b},98251:function(e,t,n){"use strict";var a=n(85597),i=n(41547),r=n(67294);t.Z=(0,r.memo)(function({identity:e,size:t=30,user:n}){let{useGetItem:l}=(0,a.OgA)(),o=l(e);return n||o?r.createElement(i.Yt,{user:n||o,size:t,noLink:!0}):null})},38779:function(e,t,n){"use strict";n.d(t,{Z:function(){return el}});var a=n(2475),i=n(85597),r=n(81719),l=n(67294);let o=l.createContext(l.createRef());var s=n(98251),c=n(10159),d=n(27937),p=n(13478),u=n(86010),m=n(41547),g=n(21822),h=n(38790);let f="MsgActionMenu",v=(0,r.ZP)("div",{name:f,slot:"root"})(({theme:e})=>({"& .MuiActionMenu-menu":{overflow:"auto",maxHeight:"220px"}})),b=(0,r.ZP)(g.Z,{name:f,slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.5),cursor:"pointer",minWidth:e.spacing(3),lineHeight:e.spacing(2.5)}));function x({identity:e,handleAction:t,scrollRef:n,items:a}){let{ItemActionMenu:r,i18n:o}=(0,i.OgA)();return l.createElement(v,null,l.createElement(r,{disablePortal:!0,items:a,placement:"auto-start",identity:e,handleAction:t,dependName:"chatplus/msgActionMenu",scrollRef:n,scrollClose:!0,control:l.createElement(h.Z,{title:o.formatMessage({id:"more"}),placement:"top",PopperProps:{disablePortal:!0}},l.createElement(b,{disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0,className:"uiChatItemBtn"},l.createElement(m.zb,{icon:"ico-dottedmore-vertical-o"})))}))}var y=n(25722),E=n(62937),w=n(40471),P=n(22410),k=n(73327),C=n(41609),Z=n.n(C);let R=(0,P.Z)(e=>(0,k.Z)({paper:{borderRadius:24,margin:0,padding:0},itemsRoot:{display:"flex",flexDirection:"row"},itemRoot:{padding:"4px",display:"flex",alignItem:"center",alignSelf:"center"},itemImage:{width:27,height:27},active:{background:e.palette.grey["300"],padding:e.spacing(.5),borderRadius:e.spacing(1),width:34,height:34,display:"flex",alignItem:"center",justifyContent:"center",margin:e.spacing(.2)}}),{name:"ReactionThisItemPopover"}),A=({item:e,classes:t,onClick:n,active:a})=>{return l.createElement("div",{className:(0,u.default)(t.itemRoot,a&&t.active),role:"button",onClick:n,"aria-label":e.title,"data-testid":"itemReaction"},l.createElement(h.Z,{title:e.title},l.createElement("img",{src:e.src,draggable:!1,alt:e.title,className:t.itemImage})))};var M=function({onEmojiClick:e,unsetReaction:t,identity:n}){let{useSession:a}=(0,i.OgA)(),r=(0,w.z)(),o=R(),s=(0,c.v2)(n),{user:d}=a(),p=e=>{var t,n;if(Z()(null==s?void 0:null===(t=s.reactions)||void 0===t?void 0:t[e]))return!1;let a=null==s?void 0:null===(n=s.reactions)||void 0===n?void 0:n[e].some(e=>e.user_name===d.user_name);return a},u=n=>{let a=p(n);a?t(n):e(n,null)};return l.createElement("div",{className:o.itemsRoot},r.map(e=>{return l.createElement(A,{key:e.id.toString(),onClick:()=>{u(`:reaction_${e.id.toString()}:`)},classes:o,item:e,active:p(`:reaction_${e.id}:`)})}))};let S=(0,r.ZP)(y.Z)(({theme:e})=>({margin:0,padding:e.spacing(0,.5),maxHeight:"48px",display:"flex",alignItems:"center",whiteSpace:"nowrap"}));function I({onEmojiClick:e,multiple:t=!0,disabled:n,scrollRef:a,scrollClose:r,placement:o="top",label:s="insert_an_emoji",control:c,identity:d,unsetReaction:p}){let{i18n:u}=(0,i.OgA)(),g=u.formatMessage({id:s}),[h,f]=l.useState(null),v=l.useRef(),[b,x]=l.useState(!1),y=l.useCallback(()=>{x(!1)},[]),w=l.useCallback(e=>{x(e=>!e),f(h?null:e.currentTarget)},[]),P=l.useCallback((n,a)=>{e&&e(n,a),t||x(!1)},[t,e]),k=l.useCallback(e=>{p&&p(e),x(!1)},[p]);return l.useEffect(()=>{if(b&&a&&a.current&&r){let e=()=>x(!1);return a.current.addEventListener("scroll",e),()=>{null==a||a.current.removeEventListener("scroll",e)}}},[b]),l.createElement(l.Fragment,null,l.createElement(m.Qn,{excludeRef:v,onClickAway:y},l.createElement(c,{onClick:w,disabled:n,title:g,"data-testid":"buttonAttachEmoji",icon:"ico-smile-o"})),l.createElement(E.Z,{ref:v,open:b,anchorEl:h,placement:o,role:"presentation",style:{zIndex:5e3}},l.createElement(S,{"data-testid":"dialogEmojiPicker"},l.createElement(M,{onEmojiClick:P,unsetReaction:k,identity:d}))))}function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let z=(0,r.ZP)(g.Z,{name:"MsgEmojiPicker",slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.75),cursor:"pointer",minWidth:e.spacing(2.5),lineHeight:e.spacing(2.5)})),_=l.forwardRef((e,t)=>{return l.createElement(z,F({className:"uiChatItemBtn uiChatIconBtn",disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0},e,{ref:t}),l.createElement(m.zb,{icon:"ico-smile-o"}))});function O({handleAction:e,scrollRef:t,identity:n}){let a=l.useCallback((t,n=null)=>e("chat/messageReaction",{shortcut:t,unicode:n}),[e]),i=l.useCallback(t=>{e("chat/unsetReaction",{identity:n,shortcut:t})},[e]);return l.createElement(I,{size:"small",multiple:!1,onEmojiClick:a,unsetReaction:i,control:_,scrollRef:t,scrollClose:!0,identity:n})}let j=(0,r.ZP)("div",{name:"MsgToolbar",slot:"uiChatToolbar",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",justifyContent:"center",alignItems:"center",...!t&&{flexDirection:"row-reverse"}}));function T({items:e,disabled:t,disableReact:n,handleAction:a,identity:r,isOwner:o}){let{useScrollRef:s}=(0,i.OgA)(),c=s();return t?null:l.createElement(j,{isOwner:o,className:"uiChatToolbar"},l.createElement(x,{identity:r,items:e,scrollRef:c,handleAction:a}),n?null:l.createElement(O,{scrollRef:c,handleAction:a,identity:r}))}let B="MsgItem",D=(0,r.ZP)("div",{name:B,slot:"uiChatMsgItem",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({...t&&{flexDirection:"row-reverse"},minHeight:"40px",marginBottom:e.spacing(.5)})),W=(0,r.ZP)("div",{name:B,slot:"uiChatMsgItemBody",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isShowReact"!==e})(({theme:e,isOwner:t,isAlert:n,isShowReact:a})=>({display:"flex","&:hover .uiChatItemBtn":{visibility:"visible"},...t&&{flexDirection:"row-reverse"},...n&&{textAlign:"center",...a&&{justifyContent:"center"}}})),H=(0,r.ZP)("div",{name:B,slot:"uiChatMsgItemBodyOuter",shouldForwardProp:e=>"hasToolbar"!==e&&"multiImage"!==e&&"isOwner"!==e&&"isPageAllMessages"!==e&&"msgType"!==e&&"msgContentType"!==e})(({theme:e,hasToolbar:t,multiImage:n,isOwner:a,isPageAllMessages:i,msgType:r,msgContentType:l})=>({maxWidth:"100%",...t&&{maxWidth:"calc(100% - 42px)"},...t&&i&&{maxWidth:"calc(65% - 42px)"},..."messageDeleted"===l&&!a&&{maxWidth:"calc(100% - 26px)"},...n&&{maxWidth:"160px"},...n&&a&&{maxWidth:"190px"},...n&&i&&{maxWidth:"400px"},...i&&("message_pinned"===r||"message_unpinned"===r)&&{maxWidth:"400px"}}));function L({msgId:e,authUser:t,showToolbar:n=!0,disableReact:r,handleAction:o}){let{jsxBackend:s,usePageParams:m,useGetItem:g}=(0,i.OgA)(),h=`chat.entities.message.${e}`,f=g(h),v=m(),b=(null==v?void 0:v.rid)||!1,[x]=(0,i.zXz)(h,{}),y=(0,c.PB)(),{id:E,type:w,attachments:P,reactions:k,created_at:C,user:Z}=f||{},R=g(Z),A=t.id===(null==R?void 0:R.id),M=(0,a.jF)(C),S=(0,a.qF)(P),I=(0,a.vS)(w),F=l.useMemo(()=>(0,p.W$)(y,{isSearch:!1,allowEdit:A,item:f,canDelete:A}),[y,!1,A,f,A]);if(!f)return null;let z=(e,t,n)=>{x(e,t,n),o(e,f,n)},_="messageDeleted"!==w;return l.createElement(D,{isOwner:A,"data-id":E,"data-t":w,"data-testid":E},l.createElement(W,{isOwner:A,isAlert:I,isShowReact:_},l.createElement(H,{hasToolbar:n,multiImage:S>1,isOwner:A,isPageAllMessages:b,msgType:w,className:(0,u.default)("uiChatMsgItemBodyOuter")},s.render({component:`chat.messageContent.${w}`,props:{message:f,isOwner:A,user:Z,createdDate:M,msgType:w,tooltipPosition:"top"}})),_&&!I&&l.createElement(T,{identity:h,handleAction:z,disabled:!n,disableReact:r,items:F,isOwner:A})),_&&l.createElement(d.Z,{identity:h,disabled:!k,reactions:k,isOwner:A,handleAction:z}))}let N="MsgSet",$=(0,r.ZP)("div",{name:N,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:n})=>({display:"flex",flexDirection:"row",padding:e.spacing(.5,2),...n&&{"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse",padding:e.spacing(0,2)}})),U=(0,r.ZP)("div",{name:N,slot:"uiChatMsgSetAvatar",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e})(({theme:e,isOwner:t,isAlert:n})=>({marginRight:e.spacing(1),display:"flex",alignItems:"flex-end",marginBottom:e.spacing(.75),...t&&{display:"none",flexDirection:"row-reverse"},...n&&{display:"none"},"& > span":{cursor:"default"}})),Y=(0,r.ZP)("div",{name:N,slot:"uiChatMsgSetBody",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({flex:1,minWidth:0,...t&&{flexDirection:"row-reverse"}}));function G({msgSet:e,disableReact:t,handleAction:n}){let{useSession:a,useGetItem:r}=(0,i.OgA)(),{user:o}=a(),c=r(null==e?void 0:e.user);if(!e)return;let{items:d}=e,p=o.id===c.id;return d&&d.length?l.createElement($,{isOwner:p,className:`uiChatMsgSet ${p?"isOwner":""}`},l.createElement(U,{isOwner:p,className:"uiChatMsgSetAvatar"},l.createElement(s.Z,{user:c,size:32})),l.createElement(Y,{className:"uiChatMsgSetBody"},d.map((e,a)=>l.createElement(L,{authUser:o,key:e.toString(),msgId:e,disableReact:t,handleAction:n})))):null}function q({msgGroup:e,disableReact:t,handleAction:n}){if(!e)return null;let{items:a}=e;return a?l.createElement("div",null,a.map((e,a)=>l.createElement(G,{msgSet:e,key:`k.0${a}`,disableReact:t,handleAction:n}))):null}var K=n(19382);let X=(0,r.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({"&:not(:first-of-type)":{marginTop:e.spacing(.75)},position:"relative",padding:e.spacing(1),maxWidth:"245px",backgroundColor:e.palette.grey["100"],..."dark"===e.palette.mode&&{backgroundColor:e.palette.grey["600"]},borderRadius:e.spacing(1.25),overflow:"hidden",...t&&{maxWidth:"400px",padding:e.spacing(1.25,1)}})),Q=(0,r.ZP)("div")(({theme:e})=>({display:"flex",alignItems:"center","& .ico":{marginRight:e.spacing(.75)}})),J=(0,r.ZP)(m.Ys)(({theme:e})=>({flex:1,minWidth:0,fontSize:e.mixins.pxToRem(12)})),V=(0,r.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({position:"absolute",bottom:0,left:0,right:0,padding:e.spacing(0,1),...t&&{span:{height:e.spacing(.75)}}}));var ee=function({count:e=1,files:t,progress:n=0,isAllPage:a=!1}){let{i18n:r}=(0,i.OgA)();if(t||t.length)return l.createElement(X,{isAllPage:a},l.createElement(Q,null,l.createElement(m.zb,{icon:"ico-paperclip-alt"}),l.createElement(J,{lines:1},1===e?l.createElement(l.Fragment,null,r.formatMessage({id:"uploading_name"},{name:t[0].name})):r.formatMessage({id:"uploading_n_attachments"},{count:e}))),l.createElement(V,{isAllPage:a},l.createElement(K.Z,{variant:"determinate",value:n})))};function et(){return(et=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}let en=(0,r.ZP)("div")(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",marginBottom:e.spacing(.5),padding:e.spacing(.5,2)})),ea=(0,r.ZP)("div",{shouldForwardProp:e=>"isAllPage"!==e})(({theme:e,isAllPage:t})=>({display:"flex",flexDirection:"column",alignItems:"flex-end",width:"100%",...t&&{maxWidth:'calc(~"100% - 50px")'}}));var ei=function({data:e,eventInit:t,isAllPage:n=!1}){let a=Object.keys(e),i=a.map(t=>{return{id:t,...e[t]}});return(l.useEffect(()=>{t&&t()},[i]),i.length)?l.createElement(en,null,l.createElement(ea,{isAllPage:n},i.map(e=>l.createElement(ee,et({},e,{key:e.id,isAllPage:n}))))):null};let er=(0,r.ZP)("div",{name:"Messages",slot:"DateTimeGroup"})(({theme:e})=>({textAlign:"center",color:e.palette.grey["600"]}));var el=l.forwardRef(function({rid:e,groups:t,groupIds:n,newest:r,disableReact:s,room:c,containerRef:d,handleAction:p,isAllPage:u,roomProgress:m,loading:g},h){let f=(0,i.lJz)(),[v,b]=l.useState(!1),x=()=>{let e=f.current.scrollHeight+0;f.current.scrollTo({top:e})};return(l.useEffect(()=>{v&&setTimeout(()=>{x()},100)},[e,v,g]),l.useEffect(()=>{return b(!!(null==n?void 0:n.length)),()=>b(!1)},[null==n?void 0:n.length]),l.useLayoutEffect(()=>{if((null==f?void 0:f.current)&&r){let e=f.current;e.scrollHeight-e.scrollTop-110<=e.clientHeight&&x()}},[r]),l.useImperativeHandle(h,()=>{return{scrollToBottom:()=>{x()}}}),c&&t)?l.createElement(o.Provider,{value:d},n.map((e,n)=>{var i,r;return l.createElement("div",{key:`k.0${n}`},t[e]&&(0,a.jF)(null===(i=t[e])||void 0===i?void 0:i.ts)?l.createElement(er,null,(0,a.jF)(null===(r=t[e])||void 0===r?void 0:r.ts)):null,l.createElement(q,{msgGroup:t[e],disableReact:s,handleAction:p}))}),Z()(m)?null:l.createElement(ei,{data:m,eventInit:x,isAllPage:u})):null})},27937:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var a=n(85597),i=n(81719),r=n(67294),l=n(40471),o=n(47037),s=n.n(o);let c=(0,i.ZP)("span")(({theme:e})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:e.spacing(0,.25)})),d=(0,i.ZP)("img")(({theme:e})=>({width:15,height:15}));function p({id:e,users:t=[]}){let n=(0,l.z)();if(!e||!t.length)return null;let a=s()(e)&&e.split(":")[1].split("_")[1];if(!a||!n)return null;let i=n.find(e=>e.id===parseInt(a));return r.createElement(c,null,r.createElement(d,{src:null==i?void 0:i.src,draggable:!1,alt:null==i?void 0:i.title}))}let u=(0,i.ZP)("div",{shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",margin:0,padding:0,marginBottom:e.spacing(-.25),...t&&{flexDirection:"row-reverse"}})),m=(0,i.ZP)("span")(({theme:e})=>({marginLeft:e.spacing(.5),position:"relative",top:"-1px",fontSize:e.typography.pxToRem(14),height:e.spacing(2.5),fontWeight:e.typography.fontWeightRegular})),g=(0,i.ZP)("div")(({theme:e})=>({cursor:"pointer",color:e.palette.grey["800"],backgroundColor:e.palette.grey["50"],position:"relative",borderRadius:e.spacing(1),lineHeight:e.spacing(2.5),whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",padding:e.spacing(.5,.75),boxShadow:"0px 0px 15px 0px #00000026",transform:"translateY(-10px)",height:e.spacing(3),zIndex:2}));function h({identity:e,disabled:t,reactions:n,isOwner:i,handleAction:l}){let{dispatch:o}=(0,a.OgA)(),s=()=>{o({type:"chat/presentReactionsList",payload:{identity:e}})};if(t||!n||!Object.keys(n).length)return null;let c=0,d=Object.keys(n).reduce((e,t)=>{var a;return c+=null===(a=n[t])||void 0===a?void 0:a.length,{...e,[t]:n[t]}},{});return r.createElement(u,{isOwner:i},r.createElement(g,{onClick:s},Object.keys(d).slice(0,3).map((e,t)=>r.createElement(p,{id:e,users:d[e],key:`k${t}`})),r.createElement(m,null,c)))}},40471:function(e,t,n){"use strict";n.d(t,{z:function(){return l}});var a=n(86706),i=n(22222);let r=(0,i.P1)(e=>e.preaction.data.reactions,e=>e);function l(){return(0,a.v9)(r)}}}]);