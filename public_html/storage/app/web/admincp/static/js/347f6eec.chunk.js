"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-chatplus-components-ChatRoomPanel-Header-FilterMessagesPopper","metafox-chatplus-components-Avatar"],{6867:function(e,t,n){n.d(t,{Z:function(){return M}});var r=n(63366),a=n(87462),i=n(67294),o=n(86010),l=n(2097),s=n(94780),c=n(1588),d=n(34867);function u(e){return(0,d.Z)("MuiBadge",e)}(0,c.Z)("MuiBadge",["root","badge","invisible"]);var p=n(34261),m=n(85893);let g=["badgeContent","component","children","invisible","max","slotProps","slots","showZero"],h=e=>{let{invisible:t}=e;return(0,s.Z)({root:["root"],badge:["badge",t&&"invisible"]},u,void 0)},v=i.forwardRef(function(e,t){let{component:n,children:i,max:o=99,slotProps:s={},slots:c={},showZero:d=!1}=e,u=(0,r.Z)(e,g),{badgeContent:v,max:f,displayValue:b,invisible:y}=function(e){let{badgeContent:t,invisible:n=!1,max:r=99,showZero:a=!1}=e,i=(0,l.Z)({badgeContent:t,max:r}),o=n;!1!==n||0!==t||a||(o=!0);let{badgeContent:s,max:c=r}=o?i:e,d=s&&Number(s)>c?`${c}+`:s;return{badgeContent:s,invisible:o,max:c,displayValue:d}}((0,a.Z)({},e,{max:o})),Z=(0,a.Z)({},e,{badgeContent:v,invisible:y,max:f,showZero:d}),x=h(Z),w=n||c.root||"span",E=(0,p.Z)({elementType:w,externalSlotProps:s.root,externalForwardedProps:u,additionalProps:{ref:t},ownerState:Z,className:x.root}),O=c.badge||"span",P=(0,p.Z)({elementType:O,externalSlotProps:s.badge,ownerState:Z,className:x.badge});return(0,m.jsxs)(w,(0,a.Z)({},E,{children:[i,(0,m.jsx)(O,(0,a.Z)({},P,{children:b}))]}))});var f=n(81719),b=n(78884),y=n(69633),Z=n(36622);function x(e){return(0,d.Z)("MuiBadge",e)}let w=(0,c.Z)("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),E=["anchorOrigin","className","component","components","componentsProps","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],O=e=>{let{color:t,anchorOrigin:n,invisible:r,overlap:a,variant:i,classes:o={}}=e,l={root:["root"],badge:["badge",i,r&&"invisible",`anchorOrigin${(0,Z.Z)(n.vertical)}${(0,Z.Z)(n.horizontal)}`,`anchorOrigin${(0,Z.Z)(n.vertical)}${(0,Z.Z)(n.horizontal)}${(0,Z.Z)(a)}`,`overlap${(0,Z.Z)(a)}`,"default"!==t&&`color${(0,Z.Z)(t)}`]};return(0,s.Z)(l,x,o)},P=(0,f.ZP)("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,t)=>t.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),C=(0,f.ZP)("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.badge,t[n.variant],t[`anchorOrigin${(0,Z.Z)(n.anchorOrigin.vertical)}${(0,Z.Z)(n.anchorOrigin.horizontal)}${(0,Z.Z)(n.overlap)}`],"default"!==n.color&&t[`color${(0,Z.Z)(n.color)}`],n.invisible&&t.invisible]}})(({theme:e,ownerState:t})=>(0,a.Z)({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:20,lineHeight:1,padding:"0 6px",height:20,borderRadius:10,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen})},"default"!==t.color&&{backgroundColor:(e.vars||e).palette[t.color].main,color:(e.vars||e).palette[t.color].contrastText},"dot"===t.variant&&{borderRadius:4,height:8,minWidth:8,padding:0},"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${w.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${w.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${w.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap&&{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${w.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${w.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${w.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${w.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap&&{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${w.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},t.invisible&&{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})})),R=i.forwardRef(function(e,t){var n,i,s,c,d,u;let p;let g=(0,b.Z)({props:e,name:"MuiBadge"}),{anchorOrigin:h={vertical:"top",horizontal:"right"},className:f,component:Z="span",components:x={},componentsProps:w={},overlap:R="rectangular",color:M="default",invisible:k=!1,max:$,badgeContent:I,slots:z,slotProps:S,showZero:A=!1,variant:j="standard"}=g,B=(0,r.Z)(g,E),_=(0,l.Z)({anchorOrigin:h,color:M,overlap:R,variant:j}),F=k;!1!==k||(0!==I||A)&&(null!=I||"dot"===j)||(F=!0);let{color:T=M,overlap:N=R,anchorOrigin:D=h,variant:W=j}=F?_:g,H=(0,a.Z)({},g,{anchorOrigin:D,invisible:F,color:T,overlap:N,variant:W}),L=O(H);"dot"!==W&&(p=I&&Number(I)>$?`${$}+`:I);let U=null!=(n=null!=(i=null==z?void 0:z.root)?i:x.Root)?n:P,q=null!=(s=null!=(c=null==z?void 0:z.badge)?c:x.Badge)?s:C,Q=null!=(d=null==S?void 0:S.root)?d:w.root,X=null!=(u=null==S?void 0:S.badge)?u:w.badge;return(0,m.jsx)(v,(0,a.Z)({invisible:k,badgeContent:p,showZero:A,max:$},B,{slots:{root:U,badge:q},className:(0,o.default)(null==Q?void 0:Q.className,L.root,f),slotProps:{root:(0,a.Z)({},Q,(0,y.Z)(U)&&{as:Z,ownerState:(0,a.Z)({},null==Q?void 0:Q.ownerState,{anchorOrigin:D,color:T,overlap:N,variant:W})}),badge:(0,a.Z)({},X,{className:(0,o.default)(L.badge,null==X?void 0:X.className)},(0,y.Z)(q)&&{ownerState:(0,a.Z)({},null==X?void 0:X.ownerState,{anchorOrigin:D,color:T,overlap:N,variant:W})})},ref:t}))});var M=R},69633:function(e,t,n){var r=n(28442);let a=e=>{return!e||!(0,r.Z)(e)};t.Z=a},69709:function(e,t,n){n.r(t);var r=n(85597),a=n(27274),i=n(7961),o=n(6867),l=n(81719),s=n(62097),c=n(67294),d=n(93836),u=n(42977),p=n(17563);let m=(0,l.ZP)(i.Z,{name:"AvatarWrapper"})(({theme:e})=>({borderWidth:"thin",borderStyle:"solid",borderColor:e.palette.border.secondary})),g=(0,l.ZP)(r.rUS,{name:"Link"})(({theme:e})=>({"&:hover":{textDecoration:"none"}})),h=(0,l.ZP)(o.Z,{shouldForwardProp:e=>"status"!==e})(({theme:e,status:t})=>({"& .MuiBadge-badge":{...0===t&&{display:"none"},...1===t&&{color:e.palette.success.main,backgroundColor:e.palette.success.main},...2===t&&{color:e.palette.warning.main,backgroundColor:e.palette.warning.main},...3===t&&{color:e.palette.error.main,backgroundColor:e.palette.error.main},boxShadow:"dark"===e.palette.mode?"none":`0 0 0 2px ${e.palette.background.paper}`,"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}}})),v=(0,l.ZP)("div",{shouldForwardProp:e=>"sizeProps"!==e})(({theme:e,sizeProps:t})=>({position:"relative",width:"32px",height:"32px",...t&&{width:t,height:t}})),f=(0,l.ZP)(i.Z,{shouldForwardProp:e=>"sizeProps"!==e})(({theme:e,sizeProps:t})=>({position:"absolute",bottom:0,left:0,width:"26px",height:"26px",backgroundColor:"dark"===e.palette.mode?e.palette.grey["600"]:e.palette.grey["300"],borderWidth:1,borderStyle:"solid",borderColor:"light"===e.palette.mode?e.palette.grey["50"]:e.palette.grey["800"],zIndex:2,...t&&{width:t-6,height:t-6}})),b=(0,l.ZP)(i.Z,{shouldForwardProp:e=>"sizeProps"!==e})(({theme:e,sizeProps:t})=>({position:"relative",top:-2,left:6,width:"26px",height:"26px",...t&&{width:`${t-6}px !important`,height:`${t-6}px !important`}}));t.default=(0,c.memo)(function({username:e="Name",name:t="Name",src:n,size:o,to:l,onClick:y,status:Z=0,room:x,uploadLocal:w=!1,roomType:E=null,avatarETag:O,hoverCard:P=!1,component:C="span"}){var R,M;let{getSetting:k}=(0,r.OgA)(),$=(0,s.Z)(),I=E||(null==x?void 0:x.t),z=(0,a.vK)(t),S={width:o,height:o,color:$.palette.grey["50"],fontSize:$.mixins.pxToRem(14.4)},A=k("chatplus"),j=null==A?void 0:null===(R=A.server)||void 0===R?void 0:R.replace(/\/$/,""),B=n;if(B||(B=O?`${j}/avatar/${e}?${p.stringify({etag:O})}`:""),z&&(S.backgroundColor=a.kU.hex(z)),l)return c.createElement(g,{to:l||`/${e}`},c.createElement(m,{src:B,alt:t,style:S,component:C,children:z}));if([d.n.Private,d.n.Public].includes(I)){if(w)return c.createElement(m,{src:B,alt:t,style:S,component:C,children:z});if(null==x?void 0:x.avatarETag)return B=`${j}/avatar/room/${null==x?void 0:x.id}?${p.stringify({etag:null==x?void 0:x.avatarETag})}`,c.createElement(m,{src:B,alt:t,style:S,component:C,children:z});{let _=`${j}/avatar/${null==x?void 0:null===(M=x.u)||void 0===M?void 0:M.username}`;return c.createElement(v,{sizeProps:o},c.createElement(f,{sizeProps:o,src:_,alt:t,component:C,children:z}),c.createElement(b,{sizeProps:o,src:B,alt:t,style:S,component:C,children:z}))}}if(I===d.n.Direct&&Z){let F=(0,u.xW)(Z);return c.createElement(h,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",status:F},c.createElement(i.Z,{src:B,alt:t,style:S,component:C,children:z}))}return c.createElement(m,{src:B,alt:t,style:S,component:C,children:z,onClick:y,to:e,hoverCard:P})})},35034:function(e,t,n){n.r(t),n.d(t,{default:function(){return _}});var r=n(39312),a=n(85597),i=n(21241),o=n(41547),l=n(30120),s=n(25722),c=n(62937),d=n(81719),u=n(91647),p=n(67294),m=n(41609),g=n.n(m),h=n(93836),v=n(42977),f=n(27274),b=n(86010),y=n(96095),Z=n(59045),x=n(83940);let w="MsgItemFilterPopper",E=(0,d.ZP)("div",{name:w,slot:"uiChatMsgItemBody",shouldForwardProp:e=>"file"!==e})(({theme:e,file:t})=>({display:t?"block":"flex"})),O=(0,d.ZP)("div",{name:w,slot:"uiChatMsgSet",shouldForwardProp:e=>"isOwner"!==e&&"isAlert"!==e&&"isGroup"!==e&&"file"!==e})(({theme:e,isOwner:t,isAlert:n,isGroup:r,file:a})=>({display:"flex",flexDirection:"row",padding:e.spacing(1.25),borderBottom:e.mixins.border("secondary"),width:"100%",...n&&{"&.uiChatMsgSetAvatar":{display:"none"},"&.uiChatMsgItemCall":{border:"none"},"&.uiChatMsgActions":{justifyContent:"center","&.my-1; .btn":{"&.mx-1":"!important"}}},...t&&{flexDirection:"row-reverse"}})),P=(0,d.ZP)("div",{name:w,slot:"uiChatMsgSetAvatar"})(({theme:e})=>({marginRight:e.spacing(1)})),C=(0,d.ZP)("span")(({theme:e})=>({...e.typography.h5})),R=(0,d.ZP)("span")(({theme:e})=>({padding:e.spacing(.5,0)})),M=(0,d.ZP)(l.Z)(({theme:e})=>({display:"flex",flexDirection:"column",width:"calc(100% - 40px)"}));function k({msgId:e,user:t,tooltipPosition:n,isMobile:i,showToolbar:o=!0,isRoomLimited:s,room:c,type:d}){var u,m,g;let w=`chatplus.chatRooms.${c.id}.messageFilter.${e}`,k=(0,r.v2)(w),{jsxBackend:$}=(0,a.OgA)(),[I,z]=(0,a.zXz)(w,{}),S=(0,r.XP)(null==c?void 0:c.id),A=(0,r.Fy)(),j=(0,r.jS)(null==c?void 0:c.id),B=!((null==j?void 0:j.allowMessageFrom)!=="noone"),{_id:_,t:F,system:T,attachments:N,reactions:D,msgType:W,ts:H,u:L,starred:U}=k||{},q=(0,r.ID)(null==L?void 0:L._id),Q=t._id===(null==L?void 0:L._id),X=(0,v.qF)(N),G=(null==N?void 0:N.length)?null===(u=N.filter(e=>e.image_url))||void 0===u?void 0:u.length:null,K=!!((null==c?void 0:c.t)===h.n.Direct&&((null==j?void 0:j.metafoxBlocked)||(null==j?void 0:j.metafoxBlocker))),Y=!!((null==c?void 0:c.t)===h.n.Direct&&((null==j?void 0:j.blocked)||(null==j?void 0:j.blocker))),J=!!(Y||K),V=null==U?void 0:U.find(e=>e._id===t._id),ee=(null==A?void 0:A.Message_AllowStarring)&&!B&&!J,et=A.Message_AllowPinning&&S["pin-message"]&&!s&&!B&&!J,en=(S["force-delete-message"]||A.Message_AllowDeleting&&(S["delete-message"]||Q&&S["delete-own-message"]))&&!B&&!J,er=p.useMemo(()=>[{label:"unpin",icon:"ico-magic",value:"chatplus/unpinAndremoveMessage",testid:"unpinMessage",showWhen:["and",["truthy","allowPinning"],["truthy","item.pinned"],["eq","type","pin"]]},{label:"remove_star",icon:"ico-star-o",value:"chatplus/unstarAndremoveMessage",testid:"unstarMessage",showWhen:["and",["truthy","allowStarring"],["truthy","isStarred"],["eq","type","star"]]},{label:"delete",icon:"ico-trash-o",className:"item-delete",value:"chatplus/deleteMessage",testid:"deleteMessage",showWhen:["and",["truthy","canDelete"]]}],[]),ea=p.useMemo(()=>(0,f.W$)(er,{allowPinning:et,item:k,allowStarring:ee,isStarred:V,canDelete:en,type:d}),[er,et,k,ee,V,en,d]);return k?p.createElement(O,{file:Boolean(1===X||!G&&(null==k?void 0:k.file)||(null==k?void 0:null===(m=k.urls)||void 0===m?void 0:m.length))},p.createElement(P,null,p.createElement(x.Z,{name:(null==q?void 0:q.name)||(null==L?void 0:L.name),username:(null==q?void 0:q.username)||(null==L?void 0:L.username),avatarETag:(null==L?void 0:L.avatarETag)||(null==q?void 0:q.avatarETag),size:32})),p.createElement(M,null,p.createElement(l.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"}},p.createElement(l.Z,{sx:{display:"flex",flexDirection:"column"}},p.createElement(C,null,(null==L?void 0:L.username)?null==L?void 0:L.username:null==L?void 0:L.name),p.createElement(R,null,(0,v.jF)(null==H?void 0:H.$date))),p.createElement(Z.Z,{identity:w,items:ea,handleAction:I,disabled:!1,disableReact:!0,state:z,showHover:!1})),p.createElement("div",{className:"uiChatMsgItem","data-id":_,"data-t":F},p.createElement(E,{file:Boolean(1===X||!G&&(null==k?void 0:k.file)||(null==k?void 0:null===(g=k.urls)||void 0===g?void 0:g.length))},p.createElement("div",{className:(0,b.default)("uiChatMsgItemBodyOuter",{hasToolbar:o&&!T,"multi-image":X>1})},$.render({component:"chatplus.messageContent.standard",props:{message:k,isOwner:Q,user:t,createdDate:null,isRoomLimited:s,msgType:W,tooltipPosition:i?"top":n}})),p.createElement(Z.Z,{identity:w,handleAction:I,disabled:T||!o,disableReact:!0,state:z})),p.createElement(y.Z,{identity:w,disabled:!D||T,reactions:D,handleAction:I})))):null}let $="MessageFilterPopper",I=(0,d.ZP)("div",{name:$,slot:"root"})(({theme:e})=>({width:"100%"})),z=(0,d.ZP)("div",{name:$,slot:"noItemFound"})(({theme:e})=>({...e.typography.body1,padding:e.spacing(1,2),color:e.palette.grey["600"],margin:e.spacing(1,0),textAlign:"center"})),S=({archived:e,settings:t,user:n,disableReact:r,room:i,items:o,phraseNoContent:l="no_items_found",type:s})=>{let{i18n:c}=(0,a.OgA)();return g()(o)?p.createElement(z,null,c.formatMessage({id:l})," "):p.createElement(I,null,o&&Object.values(o).map(a=>p.createElement(k,{key:a._id,msgId:a._id,archived:e,settings:t,perms:{},isMobile:!1,user:n,disableReact:r,room:i,type:s})))};function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let j=(0,d.ZP)("div")(({theme:e})=>({display:"flex",alignItems:"flex-end"})),B=(0,d.ZP)(l.Z,{shouldForwardProp:e=>"noContent"!==e})(({theme:e,noContent:t})=>{var n;return{padding:e.spacing(1.5,2),display:"flex",alignItems:"center",justifyContent:"space-between",...!t&&{borderBottom:"1px solid",borderColor:null===(n=e.palette.border)||void 0===n?void 0:n.secondary}}});function _({anchorRef:e,open:t,placement:n,type:l,closePopover:d,...m}){let{i18n:g,usePageParams:h,dispatch:v}=(0,a.OgA)(),f=h(),{rid:b}=f,y=(0,r.dC)(b),Z=(0,r.Oy)(),x=(0,r.jS)(b),w=(0,r.F5)(b),E=(0,r.Fy)(),O=!!(null==x?void 0:x.archived);return p.useEffect(()=>{return"pin"===l&&v({type:"chatplus/room/searchMessages",payload:{roomId:null==w?void 0:w.id,filter:"pin"}}),"star"===l&&v({type:"chatplus/room/searchMessages",payload:{roomId:null==w?void 0:w.id,filter:"star"}}),()=>{v({type:"chatplus/room/deleteMessagesFilter",payload:{identity:null==w?void 0:w.id}})}},[l]),p.createElement(o.Qn,{excludeRef:e,onClickAway:d},p.createElement(c.Z,A({id:"chatplus","data-testid":"chatplus",anchorEl:null==e?void 0:e.current,open:t,placement:n||"bottom-end"},m),p.createElement(s.Z,{sx:{width:320,overflow:"hidden",userSelect:"none"}},p.createElement(B,null,p.createElement(j,null,p.createElement(u.Z,{variant:"h4"},g.formatMessage({id:"pin"===l?"pinned_messages":"starred_messages"})))),p.createElement(i.l$,{autoHide:!0,autoHeight:!0,autoHeightMax:390,autoHeightMin:40},p.createElement(S,{user:Z,items:y,archived:O,room:w,isMobile:!1,settings:E,disableReact:!0,phraseNoContent:"pin"===l?"no_pinned_messages":"no_starred_messages",type:l})))))}},83940:function(e,t,n){var r=n(93836),a=n(67294),i=n(69709);t.Z=(0,a.memo)(function({username:e,name:t,size:n="sm",status:o=null,room:l=null,avatarETag:s,hoverCard:c}){return a.createElement(i.default,{username:e,size:n,name:t,roomType:r.n.Direct,status:o,room:l,avatarETag:s,hoverCard:c})})},96095:function(e,t,n){n.d(t,{Z:function(){return v}});var r=n(85597),a=n(81719),i=n(67294),o=n(40471),l=n(47037),s=n.n(l);let c=(0,a.ZP)("span")(({theme:e})=>({display:"inline-flex",alignItems:"center",justifyContent:"center",margin:e.spacing(0,.25)})),d=(0,a.ZP)("img")(({theme:e})=>({width:15,height:15}));function u({id:e,usernames:t}){let n=(0,o.z)();if(!e||!t)return null;let r=s()(e)&&e.split(":")[1].split("_")[1];if(!r||!n)return null;let a=n.find(e=>e.id===parseInt(r));return i.createElement(c,null,i.createElement(d,{src:null==a?void 0:a.src,draggable:!1,alt:null==a?void 0:a.title}))}function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let m=(0,a.ZP)("div",{shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",margin:0,padding:0,marginBottom:e.spacing(-.25),...t&&{flexDirection:"row-reverse"}})),g=(0,a.ZP)("span")(({theme:e})=>({marginLeft:e.spacing(.5),position:"relative",top:"-1px",fontSize:e.typography.pxToRem(14),height:e.spacing(2.5),fontWeight:e.typography.fontWeightRegular})),h=(0,a.ZP)("div")(({theme:e})=>({cursor:"pointer",color:e.palette.grey["800"],backgroundColor:e.palette.grey["50"],position:"relative",borderRadius:e.spacing(1),lineHeight:e.spacing(2.5),whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",padding:e.spacing(.5,.75),boxShadow:"0px 0px 15px 0px #00000026",transform:"translateY(-10px)",height:e.spacing(3),zIndex:2}));function v({identity:e,disabled:t,reactions:n,isOwner:a,handleAction:o}){let{dispatch:l}=(0,r.OgA)(),s=()=>{l({type:"chatplus/presentReactionsList",payload:{identity:e}})};if(t||!n||!Object.keys(n).length)return null;let c=0,d=Object.keys(n).sort((e,t)=>{var r,a,i,o,l,s,c,d;return((null===(r=n[t])||void 0===r?void 0:null===(a=r.usernames)||void 0===a?void 0:a.length)||1)-((null===(i=n[e])||void 0===i?void 0:null===(o=i.usernames)||void 0===o?void 0:o.length)||1)-((null===(l=n[t])||void 0===l?void 0:null===(s=l.updatedAt)||void 0===s?void 0:s.$date)||1)-((null===(c=n[e])||void 0===c?void 0:null===(d=c.updatedAt)||void 0===d?void 0:d.$date)||1)}).reduce((e,t)=>{var r,a;return c+=null===(r=n[t])||void 0===r?void 0:null===(a=r.usernames)||void 0===a?void 0:a.length,{...e,[t]:n[t]}},{});return i.createElement(m,{isOwner:a},i.createElement(h,{onClick:s},Object.keys(d).slice(0,3).map((e,t)=>i.createElement(u,p({id:e},d[e],{key:`k${t}`}))),i.createElement(g,null,c)))}},59045:function(e,t,n){n.d(t,{Z:function(){return S}});var r=n(85597),a=n(81719),i=n(67294),o=n(41547),l=n(21822),s=n(38790);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let d="MsgActionMenu",u=(0,a.ZP)("div",{name:d,slot:"root"})(({theme:e})=>({"& .MuiActionMenu-menu":{overflow:"auto",maxHeight:"200px"}})),p=(0,a.ZP)(l.Z,{name:d,slot:"UIChatItemBtn",shouldForwardProp:e=>"showHover"!==e})(({theme:e,showHover:t})=>({position:"relative",visibility:t?"hidden":"unset",padding:e.spacing(1,.5),cursor:"pointer",minWidth:e.spacing(3),lineHeight:e.spacing(2.5)}));function m({identity:e,handleAction:t,scrollRef:n,items:a,showHover:l=!0,...d}){let{ItemActionMenu:m,i18n:g}=(0,r.OgA)();return i.createElement(u,null,i.createElement(m,c({items:a,placement:"auto-start",identity:e,handleAction:t,dependName:"chatplus/msgActionMenu",scrollRef:n,scrollClose:!0},d,{control:i.createElement(s.Z,{title:g.formatMessage({id:"more"}),placement:"top",PopperProps:{disablePortal:!0}},i.createElement(p,{showHover:l,disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0,className:"uiChatItemBtn"},i.createElement(o.zb,{icon:"ico-dottedmore-vertical-o"})))})))}var g=n(25722),h=n(62937),v=n(39312),f=n(40471),b=n(86010),y=n(22410),Z=n(73327),x=n(41609),w=n.n(x);let E=(0,y.Z)(e=>(0,Z.Z)({paper:{borderRadius:24,margin:0,padding:0},itemsRoot:{display:"flex",flexDirection:"row"},itemRoot:{padding:"4px",display:"flex",alignItem:"center",alignSelf:"center"},itemImage:{width:27,height:27},active:{background:e.palette.grey["300"],padding:e.spacing(.5),borderRadius:e.spacing(1),width:34,height:34,display:"flex",alignItem:"center",justifyContent:"center",margin:e.spacing(.2)}}),{name:"ReactionThisItemPopover"}),O=({item:e,classes:t,onClick:n,active:r})=>{return i.createElement("div",{className:(0,b.default)(t.itemRoot,r&&t.active),role:"button",onClick:n,"aria-label":e.title,"data-testid":"itemReaction"},i.createElement(s.Z,{title:e.title},i.createElement("img",{src:e.src,draggable:!1,alt:e.title,className:t.itemImage})))};var P=function({onEmojiClick:e,unsetReaction:t,identity:n}){let r=(0,f.z)(),a=E(),o=(0,v.v2)(n),l=(0,v.Oy)(),s=l.username,c=e=>{var t,n,r;return!w()(null==o?void 0:null===(t=o.reactions)||void 0===t?void 0:t[e])&&(null===(n=o.reactions)||void 0===n?void 0:null===(r=n[e])||void 0===r?void 0:r.usernames.includes(s))},d=n=>{let r=c(n);r?t(n):e(n,null)};return i.createElement("div",{className:a.itemsRoot},r.map(e=>i.createElement(O,{key:e.id.toString(),onClick:()=>{d(`:reaction_${e.id.toString()}:`)},classes:a,item:e,active:c(`:reaction_${e.id}:`)})))};let C=(0,a.ZP)(g.Z)(({theme:e})=>({margin:0,padding:e.spacing(0,.5),maxHeight:"48px",display:"flex",alignItems:"center",whiteSpace:"nowrap"}));function R({onEmojiClick:e,multiple:t=!0,disabled:n,scrollRef:a,scrollClose:l,placement:s="top",label:c="insert_an_emoji",control:d,identity:u,unsetReaction:p}){let{i18n:m}=(0,r.OgA)(),g=m.formatMessage({id:c}),[v,f]=i.useState(null),b=i.useRef(),[y,Z]=i.useState(!1),x=i.useCallback(()=>{Z(!1)},[]),w=i.useCallback(e=>{Z(e=>!e),f(v?null:e.currentTarget)},[]),E=i.useCallback((n,r)=>{e&&e(n,r),t||Z(!1)},[t,e]),O=i.useCallback(e=>{p&&p(e),Z(!1)},[p]);return i.useEffect(()=>{if(y&&a&&a.current&&l){let e=()=>Z(!1);return a.current.addEventListener("scroll",e),()=>{null==a||a.current.removeEventListener("scroll",e)}}},[y]),i.createElement(i.Fragment,null,i.createElement(o.Qn,{excludeRef:b,onClickAway:x},i.createElement(d,{onClick:w,disabled:n,title:g,"data-testid":"buttonAttachEmoji",icon:"ico-smile-o"})),i.createElement(h.Z,{ref:b,open:y,anchorEl:v,placement:s,role:"presentation",style:{zIndex:5e3}},i.createElement(C,{"data-testid":"dialogEmojiPicker"},i.createElement(P,{onEmojiClick:E,unsetReaction:O,identity:u}))))}function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let k=(0,a.ZP)(l.Z,{name:"MsgEmojiPicker",slot:"UIChatItemBtn"})(({theme:e})=>({position:"relative",visibility:"hidden",padding:e.spacing(1,.75),cursor:"pointer",minWidth:e.spacing(2.5),lineHeight:e.spacing(2.5)})),$=i.forwardRef((e,t)=>{return i.createElement(k,M({className:"uiChatItemBtn uiChatIconBtn",disableFocusRipple:!0,disableRipple:!0,disableTouchRipple:!0},e,{ref:t}),i.createElement(o.zb,{icon:"ico-smile-o"}))});function I({handleAction:e,scrollRef:t,identity:n}){let r=i.useCallback((t,n=null)=>e("chatplus/messageReaction",{shortcut:t,unicode:n}),[e]),a=i.useCallback(t=>{e("chatplus/unsetReaction",{identity:n,shortcut:t})},[e]);return i.createElement(R,{size:"small",multiple:!1,onEmojiClick:r,unsetReaction:a,control:$,scrollRef:t,scrollClose:!0,identity:n})}let z=(0,a.ZP)("div",{name:"MsgToolbar",slot:"uiChatToolbar",shouldForwardProp:e=>"isOwner"!==e})(({theme:e,isOwner:t})=>({display:"flex",justifyContent:"center",alignItems:"center",...!t&&{flexDirection:"row-reverse"}}));function S({items:e,disabled:t,disableReact:n,handleAction:a,identity:o,isOwner:l,showHover:s}){let{useScrollRef:c}=(0,r.OgA)(),d=c();return t?null:i.createElement(z,{isOwner:l,className:"uiChatToolbar"},i.createElement(m,{identity:o,items:e,scrollRef:d,handleAction:a,showHover:s}),n?null:i.createElement(I,{scrollRef:d,handleAction:a,identity:o}))}},40471:function(e,t,n){n.d(t,{z:function(){return o}});var r=n(86706),a=n(22222);let i=(0,a.P1)(e=>e.preaction.data.reactions,e=>e);function o(){return(0,r.v9)(i)}}}]);